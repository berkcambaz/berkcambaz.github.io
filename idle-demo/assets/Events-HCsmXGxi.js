import{a1 as R,ay as F,az as E,f as z,aA as I,aB as $,aC as B,aD as L,aE as p,u as d,r as w,j as e,C as Z,F as u,T as O,k as M,l as ee,n as te,aa as i,B as se,g as _,a as H,aF as Y,aG as G,as as C,D as v,m as A}from"./index-8ppehLxy.js";import{F as P,R as g}from"./FullscreenModal-r4zo4MKw.js";import{S as D}from"./ScrollArea-e2MVZrqT.js";import{u as U}from"./use-disclosure-fwGS97u4.js";var ne=R("circle-check","IconCircleCheck",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l2 2l4 -4",key:"svg-1"}]]),oe=R("circle","IconCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}]]);function q(s,n){const t=F(s,{id:n.achievementId}),o=E({id:n.achievementId});return!(t<o||s.events.achievements.collected[n.achievementId])}function ae(s,n){q(s,n)&&(s.events.achievements.collected[n.achievementId]=!0,z(s,{toAdd:I[n.achievementId].rewards}))}function J(s,n){const t=new Date(s.events.dailyQuests.startDate),o=new Date($(Date.now()));if(t.getUTCFullYear()!==o.getUTCFullYear()||t.getUTCMonth()!==o.getUTCMonth()||t.getUTCDate()!==o.getUTCDate())return!1;const a=B(s,{id:n.dailyQuestId}),l=L({id:n.dailyQuestId});return!(a<l||s.events.dailyQuests.collected[n.dailyQuestId])}function le(s,n){J(s,n)&&(s.events.dailyQuests.collected[n.dailyQuestId]=!0,z(s,{toAdd:p[n.dailyQuestId].rewards}))}function ce(s,n){const t=new Date,o=new Date($(s.events.dailyQuests.startDate));return!(t.getTime()<o.getTime())}function ie(s,n){ce(s)&&(s.events.dailyQuests={startDate:Date.now(),progress:{},collected:{}})}function K({dailyQuest:s,achievement:n}){const t=d(a=>a.player),o=w.useMemo(()=>{if(t){if(s)return{name:s.id,rewards:p[s.id].rewards,done:t?B(t,s):0,todo:L(s),onCollect(){d.setState(a=>{a.player&&le(a.player,{dailyQuestId:s.id})})},collectible:J(t,{dailyQuestId:s.id}),collected:!!(t!=null&&t.events.dailyQuests.collected[s.id])};if(n)return{name:n.id,rewards:I[n.id].rewards,done:t?F(t,n):0,todo:E(n),onCollect(){d.setState(a=>{a.player&&ae(a.player,{achievementId:n.id})})},collectible:q(t,{achievementId:n.id}),collected:!!(t!=null&&t.events.achievements.collected[n.id])}}},[t,s,n]);return o?e.jsx(Z,{withBorder:!0,radius:"md",children:e.jsxs(u,{direction:"column",gap:"xs",children:[e.jsx(O,{order:6,children:o.name}),e.jsx(D,{children:e.jsx(u,{gap:"xs",children:o.rewards.map(a=>a.item?e.jsx(M,{item:a.item},ee(a.item)):e.jsx(M,{monster:a.monster},te(a.monster)))})}),e.jsxs(u,{gap:"md",align:"center",children:[e.jsx(i.Root,{size:"xl",style:{flex:1},children:e.jsx(i.Section,{value:o.done/o.todo*100,children:e.jsx(i.Label,{pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%"},children:`${o.done} / ${o.todo}`})})}),e.jsx(se,{onClick:o.onCollect,disabled:!o.collectible,leftSection:o.collected?e.jsx(ne,{}):e.jsx(oe,{}),children:"Collect"})]})]})}):null}function re({opened:s,onClose:n}){var j,Q;const t=d(m=>m.player),o=((j=t==null?void 0:t.items[_])==null?void 0:j.count)??0,a=((Q=t==null?void 0:t.items[H])==null?void 0:Q.count)??0,l=t?Y(t):0,r=G(),[c,h]=w.useState("00:00:00");return w.useEffect(()=>{const N=setInterval(()=>{const k=d.getState().player;if(!k)return;const x=new Date,f=new Date($(k.events.dailyQuests.startDate)),b=Math.abs(f.getUTCHours()-x.getUTCHours()),y=Math.abs(f.getUTCMinutes()-x.getUTCMinutes()),T=Math.abs(f.getUTCSeconds()-x.getUTCSeconds()),V=b>9?b:`0${b}`,W=y>9?y:`0${y}`,X=T>9?T:`0${T}`;h(`${V}:${W}:${X}`),x.getTime()>=f.getTime()&&d.setState(S=>{S.player&&ie(S.player)})},1e3);return()=>clearInterval(N)},[]),e.jsx(P,{opened:s,onClose:n,header:e.jsxs(e.Fragment,{children:[e.jsx(C,{emoji:"ðŸª™",count:o}),e.jsx(C,{emoji:"ðŸ’Ž",count:a})]}),children:e.jsx(D,{h:"100%",children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsx(v,{label:"Daily Quests"}),e.jsx(i.Root,{size:24,w:"100%",children:e.jsx(i.Section,{value:l/r*100,children:e.jsx(i.Label,{pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%"},children:`${l} / ${r}`})})}),e.jsxs(O,{order:6,ta:"center",children:["Resets in ",c]}),Object.keys(p).map(m=>e.jsx(K,{dailyQuest:{id:m}},m))]})})})}function de({opened:s,onClose:n}){var l,r;const t=d(c=>c.player),o=((l=t==null?void 0:t.items[_])==null?void 0:l.count)??0,a=((r=t==null?void 0:t.items[H])==null?void 0:r.count)??0;return e.jsx(P,{opened:s,onClose:n,header:e.jsxs(e.Fragment,{children:[e.jsx(C,{emoji:"ðŸª™",count:o}),e.jsx(C,{emoji:"ðŸ’Ž",count:a})]}),children:e.jsx(D,{h:"100%",children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsx(v,{label:"Achievements"}),Object.keys(I).map(c=>e.jsx(K,{achievement:{id:c}},c))]})})})}function xe(){const[s,{open:n,close:t}]=U(),[o,{open:a,close:l}]=U(),r=d(j=>j.player),c=r?Y(r):0,h=G();return e.jsxs(e.Fragment,{children:[e.jsx(D,{children:e.jsxs(u,{direction:"column",gap:"md",children:[e.jsx(v,{label:"Continuous Events"}),e.jsx(g,{emoji:"ðŸ“œ",title:"Daily Quests",onClick:n,children:e.jsx(i.Root,{size:"xl",mt:"xs",w:"100%",children:e.jsx(i.Section,{value:c/h*100,children:e.jsx(i.Label,{pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%"},children:`${c} / ${h}`})})})}),e.jsx(g,{emoji:"ðŸŽ¯",title:"Achievements",onClick:a}),e.jsx(v,{label:"Limited Events"}),e.jsx(g,{emoji:"ðŸ˜ˆ",title:"Monster Hunt",onClick:()=>{},children:e.jsx(A,{ta:"left",size:"sm",c:"yellow",children:"Coming soon..."})}),e.jsx(g,{emoji:"ðŸ’³",title:"Spending Spree",onClick:()=>{},children:e.jsx(A,{ta:"left",size:"sm",c:"yellow",children:"Coming soon..."})})]})}),e.jsx(re,{opened:s,onClose:t}),e.jsx(de,{opened:o,onClose:l})]})}export{xe as default};
