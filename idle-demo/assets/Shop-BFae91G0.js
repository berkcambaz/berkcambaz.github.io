import{f as z,u as B,j as e,v as g,c as G,s as p,a as R,b,d as A,g as E,e as F,h as f,i as h,k as L,l as P,r as _,S as N,F as o,T as v,D as u,E as l,m as q,n as H,B as S,C as Q,o as T,p as U,q as w,t as W,w as k}from"./index-jqdp_aed.js";import{C as I}from"./ContentAsset-D04L5cy0.js";import{C as x}from"./ContentList-BzuBpLfK.js";import{I as y}from"./InputBase-D70diZhm.js";const J={},C=z((s,i)=>{const t=B("TextInput",J,s);return e.jsx(y,{component:"input",ref:i,...t,__staticSelector:"TextInput"})});C.classes=y.classes;C.displayName="@mantine/core/TextInput";function $(s,i){var r,a;let t,n=0,c=((r=s.items[E])==null?void 0:r.count)??0,d=((a=s.items[F])==null?void 0:a.count)??0;switch(i.shop){case"gold":if(t=p[i.index],n=s.shop.gold[i.index]??0,!t||(t.price.gold??0)>c)return!1;break;case"gem":if(t=f[i.index],n=s.shop.gem[i.index]??0,!t||(t.price.gem??0)>d)return!1;break;default:return!0}return!(g===s.shop.snapshot&&t.limit>0&&t.limit<=n)}function K(s,i){if(!$(s,i))return;g!==s.shop.snapshot&&(s.shop={snapshot:g,startDate:Date.now(),premium:{},gold:{},gem:{}});let t,n=[];switch(i.shop){case"gold":t=p[i.index],n.push({item:R((t==null?void 0:t.price.gold)??0)});break;case"gem":t=f[i.index],n.push({item:G((t==null?void 0:t.price.gem)??0)});break}t&&(s.shop[i.shop][i.index]||(s.shop[i.shop][i.index]=0),s.shop[i.shop][i.index]++,b(s,{toRemove:n}),b(s,{toAdd:[{item:t.item}]}),A.buyShopItem.dispatch({player:s}))}function M(s,i){const t=new Date,n=new Date(V(s.shop.startDate));return!(t.getTime()<n.getTime())}function O(s,i){M(s)&&(s.shop={snapshot:g,startDate:Date.now(),premium:{},gold:{},gem:{}})}function V(s){const i=new Date(s);return i.setUTCHours(23,59,59),i.getTime()}function se(){const s=h(r=>r.player),i=s?L(s.events.dailyQuests.startDate):Date.now(),t=P(i,()=>{h.setState(r=>{r.player&&O(r.player)})}),[n,c]=_.useState(""),d=()=>{};return e.jsx(N,{scrollbars:"y",children:e.jsxs(o,{direction:"column",gap:"md",children:[e.jsxs(v,{order:6,ta:"center",children:["Shop resets in ",t]}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"✨",size:16})," Special Offer"]})}),e.jsx(X,{specialOffer:q,onBuy:()=>{}}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"👑",size:16})," Premium Shop"]})}),e.jsx(x,{gap:"xs",children:H.map((r,a)=>e.jsx(j,{shop:"premium",index:a,shopItem:r},a))}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"🪙",size:16})," Gold Shop"]})}),e.jsx(x,{gap:"xs",children:p.map((r,a)=>e.jsx(j,{shop:"gold",index:a,shopItem:r},a))}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"💎",size:16})," Gem Shop"]})}),e.jsx(x,{gap:"xs",children:f.map((r,a)=>e.jsx(j,{shop:"gem",index:a,shopItem:r},a))}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"🎁",size:16})," Gift Codes"]})}),e.jsxs(o,{align:"center",gap:"xs",mx:"auto",w:"100%",maw:300,children:[e.jsx(C,{placeholder:"Enter gift code...",value:n,onChange:r=>c(r.currentTarget.value),style:{flex:1}}),e.jsx(S,{onClick:d,children:"Redeem"})]})]})})}function X({specialOffer:s,onBuy:i}){const t=n=>{k.setState(c=>{c.modals.itemDetails={opened:!0,item:n}})};return e.jsx(Q,{withBorder:!0,styles:{root:{backgroundImage:"url(/idle-demo/gggrain.svg)"}},children:e.jsxs(o,{direction:"column",align:"center",gap:"xs",children:[e.jsx(I,{size:100,image:s.asset.image,emoji:s.asset.emoji}),e.jsx(v,{order:3,c:"white",children:s.name}),e.jsx(o,{direction:"column",w:"100%",children:e.jsx(x,{gap:"xs",children:s.items.map(n=>e.jsx(T,{item:n,onClick:()=>t(n)},U(n)))})}),e.jsx(S,{w:"100%",maw:128,onClick:i,children:`Buy for $${s.money}`})]})})}function j({shop:s,index:i,shopItem:t}){const n=h(m=>m.player),c=()=>{k.setState(m=>{m.modals.itemDetails={opened:!0,item:t.item}})},d=()=>{h.setState(m=>{m.player&&K(m.player,{shop:s,index:i})})},r=()=>n?$(n,{shop:s,index:i}):!1,D=n?t.limit-(n.shop[s][i]??0):t.limit;return e.jsxs(o,{direction:"column",align:"center",w:64,children:[e.jsx(T,{item:t.item,onClick:c}),e.jsxs(S,{fullWidth:!0,size:"compact-sm",px:0,mt:"xs",onClick:d,disabled:!r(),children:[t.price.money!==void 0&&e.jsxs(e.Fragment,{children:["$",t.price.money]}),t.price.gem!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{emoji:"💎"})," ",w(t.price.gem)]}),t.price.gold!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{emoji:"🪙"})," ",w(t.price.gold)]})]}),e.jsx(W,{size:"xs",my:"xs",children:`Limit ${D<0?"∞":D}`})]})}export{se as default};
