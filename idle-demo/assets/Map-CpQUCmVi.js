import{am as N,an as $,b as k,ao as re,d as w,ap as oe,aq as H,ar as J,as as P,at as ie,au as L,av as K,a2 as le,i as p,g as q,aw as O,ax as Q,j as e,F as u,C as A,D as v,E as C,T as _,q as V,S as b,o as j,a8 as W,B as h,p as g,y as S,ay as R,w as M,r as I,A as F,G as z,az as ae,aA as ce,x as X,aB as B,aC as de,t as me}from"./index-jqdp_aed.js";import{F as U,R as T}from"./FullscreenModal-DzRHAJWl.js";import{C as y}from"./ContentList-BzuBpLfK.js";import{u as D}from"./use-disclosure-Bxt8GHo-.js";function ue(s,r){return!0}function xe(s,r){const t=Date.now();s.map.arena.dates=[t,t+1,t+2]}function Y(s,r){const t=s.items[r.itemId];return!(!t||t.id!=="ot_item_box"||t.count<=0)}function je(s,r){if(!Y(s,r))return;const t=s.items[r.itemId];if(!t)return;const o=Object.keys(oe),l=N({seed:Date.now()},o.map(a=>({result:a,percent:1/$[a].index})));if(!l)return;const i={id:l,tier:t.tier,stars:t.stars,count:1};return k(s,{toRemove:[{item:re(t.tier,t.stars,1)}],toAdd:[{item:i}]}),w.unlockItem.dispatch({player:s}),i}function Z(s,r){const t=s.items[r.itemId];return!(!t||$[t.id].type==="other"||t.count<3||t.tier==="S"&&t.stars>=5)}function fe(s,r){if(!Z(s,r))return;const t=s.items[r.itemId];if(!t)return;const o=H(t);o&&(k(s,{toAdd:[{item:o}],toRemove:[{item:{id:t.id,tier:t.tier,stars:t.stars,count:3}}]}),w.upgradeItem.dispatch({player:s}))}function ee(s,r){return r.items.map(o=>{const l=s.items[o];if(l&&$[l.id].type!=="other")return l}).filter(Boolean).length!==0}function pe(s,r){if(!ee(s,r))return!1;const t=r.items.map(i=>s.items[i]).filter(Boolean),o=J(t),l=t.map(i=>({item:i}));return k(s,{toAdd:o,toRemove:l}),w.sellItems.dispatch({player:s}),!0}function te(s,r){const t=s.items[r.itemId];return!(!t||t.id!=="ot_monster_scroll"||t.count<=0)}function he(s,r){if(!te(s,r))return;const t=s.items[r.itemId];if(!t)return;const o=Object.keys(P),l=N({seed:Date.now()},o.map(a=>({result:a,percent:1/P[a].index})));if(!l)return;const i={id:l,stars:t.stars,level:1,time:Date.now()};return k(s,{toRemove:[{item:ie(t.stars,1)}],toAdd:[{monster:i}]}),w.summonMonster.dispatch({player:s}),i}function se(s,r){const t=r.monsters.map(l=>s.monsters[l]);return!!L(t)}function ge(s,r){if(!se(s,r))return!1;const t=r.monsters.map(m=>s.monsters[m]),o=L(t);if(!o)return!1;const l=t[0],i=t[1],a=t[2];return!l||!i||!a?!1:(k(s,{toAdd:[{monster:o},...Object.values({...i==null?void 0:i.items,...a==null?void 0:a.items}).map(m=>({item:m}))],toRemove:[{monster:l},{monster:i},{monster:a}]}),w.evolveMonster.dispatch({player:s}),!0)}function ne(s,r){return r.monsters.map(o=>s.monsters[o]).filter(Boolean).length!==0}function ve(s,r){if(!ne(s,r))return!1;const t=r.monsters.map(a=>s.monsters[a]).filter(Boolean),o=t.map(a=>({monster:a})),l=[],i=K(t);return t.forEach(a=>{Object.values(a.items??{}).forEach(m=>{l.push({item:m})})}),k(s,{toAdd:[...l,...i],toRemove:o}),w.sacrificeMonsters.dispatch({player:s}),!0}var Se=le("arrow-big-down-filled","IconArrowBigDownFilled",[["path",{d:"M10 2l-.15 .005a2 2 0 0 0 -1.85 1.995v6.999l-2.586 .001a2 2 0 0 0 -1.414 3.414l6.586 6.586a2 2 0 0 0 2.828 0l6.586 -6.586a2 2 0 0 0 .434 -2.18l-.068 -.145a2 2 0 0 0 -1.78 -1.089l-2.586 -.001v-6.999a2 2 0 0 0 -2 -2h-4z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]);function be({opened:s,onClose:r}){var c;const t=p(n=>n.player),o=((c=t==null?void 0:t.items[q])==null?void 0:c.count)??0,l=(t==null?void 0:t.map.tower.stage)??0,i=t?O.tower.getLineup(t):void 0,a=Q(i),m=i?Object.values(i).filter(Boolean):void 0,f=t?O.tower.getRewards(t):void 0,x=()=>{p.getState().player&&M.setState(d=>{d.modals.lineup={opened:!0,battleId:"tower"}})};return e.jsx(U,{opened:s,onClose:r,header:e.jsx(R,{emoji:"🪙",count:o}),children:e.jsxs(u,{direction:"column",align:"center",justify:"center",gap:"md",h:"100%",children:[e.jsx(A,{withBorder:!0,radius:"md",w:"100%",maw:360,children:e.jsxs(u,{direction:"column",gap:"xs",children:[e.jsx(v,{label:"Stage Enemies"}),e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(C,{emoji:"⚡"}),e.jsx(_,{order:5,children:V(a)})]}),e.jsx(b,{children:e.jsx(u,{gap:"xs",children:m==null?void 0:m.map((n,d)=>e.jsx(j,{monster:n},d))})})]})}),e.jsx(C,{emoji:"🗼",size:100}),e.jsx(W.Root,{size:"xl",w:"100%",maw:100,children:e.jsx(W.Section,{value:100,striped:!0,animated:!0,children:e.jsx(W.Label,{pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%",overflow:"visible"},children:`Stage ${l+1}`})})}),e.jsx(h,{size:"md",onClick:x,children:"Battle"}),e.jsx(A,{withBorder:!0,radius:"md",w:"100%",maw:360,children:e.jsxs(u,{direction:"column",gap:"xs",children:[e.jsx(v,{label:"Stage Rewards"}),e.jsx(b,{children:e.jsx(u,{gap:"xs",children:f==null?void 0:f.map(n=>n.item?e.jsx(j,{item:n.item},g(n.item)):e.jsx(j,{monster:n.monster},S(n.monster)))})})]})})]})})}function Ie({opened:s,onClose:r}){var a;const[t,o]=I.useState("upgrade"),l=p(m=>m.player),i=((a=l==null?void 0:l.items[q])==null?void 0:a.count)??0;return e.jsx(U,{opened:s,onClose:r,header:e.jsx(R,{emoji:"🪙",count:i}),children:e.jsx(A,{withBorder:!0,radius:"md",h:"100%",children:e.jsx(b,{children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsxs(h.Group,{mx:"auto",w:"100%",maw:360,children:[e.jsx(h,{fullWidth:!0,px:0,variant:t!=="unlock"?"default":void 0,onClick:()=>o("unlock"),children:"Unlock"}),e.jsx(h,{fullWidth:!0,px:0,variant:t!=="upgrade"?"default":void 0,onClick:()=>o("upgrade"),children:"Upgrade"}),e.jsx(h,{fullWidth:!0,px:0,variant:t!=="sell"?"default":void 0,onClick:()=>o("sell"),children:"Sell"})]}),t==="unlock"&&e.jsx(Ce,{}),t==="upgrade"&&e.jsx(ke,{}),t==="sell"&&e.jsx(we,{})]})})})})}function Ce(){const s=p(c=>c.player),[r,t]=I.useState(void 0),o=s&&r?s.items[r]:void 0,l=s?Object.values(s.items).filter(c=>c.id==="ot_item_box"):[],i=F(l),a=()=>{let c;p.setState(n=>{n.player&&r&&(c=je(n.player,{itemId:r}))}),c&&M.setState(n=>{n.modals.contentList={opened:!0,contents:[{item:c}],onClick(){M.setState(d=>{d.modals.itemDetails={opened:!0,item:c}})}}})},m=()=>!s||!r?!1:Y(s,{itemId:r}),f=c=>{t(c)},x=()=>{t(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Unlock Items"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsx(j,{item:o,onClick:x}),e.jsx(h,{onClick:a,disabled:!m(),children:"Unlock"})]}),e.jsx(v,{label:"Item Boxes"}),e.jsx(y,{children:i==null?void 0:i.map(c=>e.jsx(j,{item:r!==g(c)?c:void 0,onClick:()=>f(g(c))},g(c)))})]})}function ke(){const s=p(d=>d.player),[r,t]=I.useState(void 0),o=s&&r?s.items[r]:void 0,l=o?H(o):void 0,i=s?Object.values(s.items).filter(d=>$[d.id].type!=="other"):[],a=F(i),m=()=>{p.setState(d=>{d.player&&r&&fe(d.player,{itemId:r})})},f=()=>!s||!r?!1:Z(s,{itemId:r}),x=d=>{t(d)},c=()=>{t(void 0)},n=()=>Math.min((o==null?void 0:o.count)??0,3);return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Upgrade Items"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsxs(u,{align:"center",gap:"md",pos:"relative",children:[e.jsx(j,{placeholder:z("we_ancient_sword").image,item:o,onClick:c}),e.jsx(ae,{}),e.jsx(_,{order:5,mt:48,pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%"},children:`${n()} / 3`}),e.jsx(j,{placeholder:z("we_broad_axe_5").image,item:l})]}),e.jsx(h,{onClick:m,disabled:!f(),children:"Upgrade"})]}),e.jsx(v,{label:"Items"}),e.jsx(y,{children:a==null?void 0:a.map(d=>e.jsx(j,{item:r!==g(d)?d:void 0,onClick:()=>x(g(d))},g(d)))})]})}function we(){const s=p(n=>n.player),[r,t]=I.useState([]),o=s?r.map(n=>n?s.items[n]:void 0).filter(Boolean):void 0,l=o?J(o):[],i=s?Object.values(s.items).filter(n=>$[n.id].type!=="other"):[],a=F(i),m=()=>{p.setState(n=>{if(!n.player||!o)return;pe(n.player,{items:r})&&t([])})},f=()=>!s||!o?!1:ee(s,{items:r}),x=n=>{r.filter(d=>d===n).length>0||t([...r,n])},c=n=>{const d=[...r];d.splice(n,1),t(d)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Sell Items"}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(b,{scrollbars:"x",children:e.jsxs(u,{justify:"center",gap:"xs",children:[r.length===0&&e.jsx(j,{placeholder:z("we_ancient_sword").image}),o==null?void 0:o.map((n,d)=>e.jsx(j,{item:n,onClick:()=>c(d)},g(n)))]})})}),e.jsx(u,{justify:"center",children:e.jsx(h,{onClick:m,disabled:!f(),variant:"light",color:"red",children:"Sell & Receive"})}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(b,{scrollbars:"x",children:e.jsx(u,{justify:"center",gap:"xs",children:l==null?void 0:l.map(n=>n.item?e.jsx(j,{item:n.item},g(n.item)):e.jsx(j,{monster:n.monster},S(n.monster)))})})}),e.jsx(v,{label:"Items"}),e.jsx(y,{children:a==null?void 0:a.map(n=>e.jsx(j,{item:r.includes(g(n))?void 0:n,onClick:()=>x(g(n))},g(n)))})]})}function ye({opened:s,onClose:r}){var m,f;const[t,o]=I.useState("evolve"),l=p(x=>x.player),i=((m=l==null?void 0:l.items[q])==null?void 0:m.count)??0,a=((f=l==null?void 0:l.items[ce])==null?void 0:f.count)??0;return e.jsx(U,{opened:s,onClose:r,header:e.jsxs(e.Fragment,{children:[e.jsx(R,{emoji:"🪙",count:i}),e.jsx(R,{emoji:"🍏",count:a})]}),children:e.jsx(A,{withBorder:!0,radius:"md",h:"100%",children:e.jsx(b,{scrollbars:"y",h:"100%",children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsxs(h.Group,{mx:"auto",w:"100%",maw:360,children:[e.jsx(h,{fullWidth:!0,px:0,variant:t!=="summon"?"default":void 0,onClick:()=>o("summon"),children:"Summon"}),e.jsx(h,{fullWidth:!0,px:0,variant:t!=="evolve"?"default":void 0,onClick:()=>o("evolve"),children:"Evolve"}),e.jsx(h,{fullWidth:!0,px:0,variant:t!=="sacrifice"?"default":void 0,onClick:()=>o("sacrifice"),children:"Sacrifice"})]}),t==="summon"&&e.jsx(Be,{}),t==="evolve"&&e.jsx(_e,{}),t==="sacrifice"&&e.jsx(Ae,{})]})})})})}function Be(){const s=p(c=>c.player),[r,t]=I.useState(void 0),o=s&&r?s.items[r]:void 0,l=s?Object.values(s.items).filter(c=>c.id==="ot_monster_scroll"):[],i=F(l),a=()=>{let c;p.setState(n=>{n.player&&r&&(c=he(n.player,{itemId:r}))}),c&&M.setState(n=>{n.modals.contentList={opened:!0,contents:[{monster:c}]}})},m=()=>!s||!r?!1:te(s,{itemId:r}),f=c=>{t(c)},x=()=>{t(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Summon Monsters"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsx(j,{item:o,onClick:x}),e.jsx(h,{onClick:a,disabled:!m(),children:"Summon"})]}),e.jsx(v,{label:"Monster Scrolls"}),e.jsx(y,{children:i.map(c=>e.jsx(j,{item:r!==g(c)?c:void 0,onClick:()=>f(g(c))},g(c)))})]})}function _e(){const s=p(n=>n.player),r=s?Object.values(s.monsters):[],t=X(r),[o,l]=I.useState([void 0,void 0,void 0]),i=s?o.map(n=>n?s.monsters[n]:void 0):void 0,a=i?L(i):void 0,m=()=>{p.setState(n=>{if(!n.player||o.filter(Boolean).length<3)return;ge(n.player,{monsters:o})&&l([void 0,void 0,void 0])})},f=()=>!s||o.filter(Boolean).length<3?!1:se(s,{monsters:o}),x=n=>{if(o.filter(E=>E===n).length>0)return;const d=o.findIndex(E=>E===void 0);if(d===-1)return;const G=[...o];G.splice(d,1,n),l(G)},c=n=>{const d=[...o];d[n]=void 0,l(d)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Evolve Monsters"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(j,{placeholder:B("angel"),monster:i==null?void 0:i[0],onClick:()=>c(0)}),e.jsx(j,{placeholder:B("angel"),monster:i==null?void 0:i[1],onClick:()=>c(1)}),e.jsx(j,{placeholder:B("angel"),monster:i==null?void 0:i[2],onClick:()=>c(2)})]}),e.jsx(Se,{}),e.jsx(j,{placeholder:B("death_knight"),monster:a}),e.jsx(h,{onClick:m,disabled:!f(),children:"Upgrade"})]}),e.jsx(v,{label:"Monsters"}),e.jsx(y,{children:t.map(n=>e.jsx(j,{monster:o.includes(S(n))?void 0:n,onClick:()=>x(S(n))},S(n)))})]})}function Ae(){const s=p(n=>n.player),r=s?Object.values(s.monsters):[],t=X(r),[o,l]=I.useState([]),i=s?o.map(n=>n?s.monsters[n]:void 0).filter(Boolean):void 0,a=i?K(i):[],m=()=>{p.setState(n=>{if(!n.player||!i)return;ve(n.player,{monsters:o})&&l([])})},f=()=>!s||!i?!1:ne(s,{monsters:o}),x=n=>{o.filter(d=>d===n).length>0||l([...o,n])},c=n=>{const d=[...o];d.splice(n,1),l(d)};return e.jsxs(e.Fragment,{children:[e.jsx(v,{label:"Sacrifice Monsters"}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(b,{scrollbars:"x",children:e.jsxs(u,{justify:"center",gap:"xs",children:[o.length===0&&e.jsx(j,{placeholder:B("angel")}),i==null?void 0:i.map((n,d)=>e.jsx(j,{monster:n,onClick:()=>c(d)},S(n)))]})})}),e.jsx(u,{justify:"center",children:e.jsx(h,{onClick:m,disabled:!f(),variant:"light",color:"red",children:"Sacrifice & Receive"})}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(b,{scrollbars:"x",children:e.jsx(u,{justify:"center",gap:"xs",children:a==null?void 0:a.map(n=>n.item?e.jsx(j,{item:n.item},g(n.item)):e.jsx(j,{monster:n.monster},S(n.monster)))})})}),e.jsx(v,{label:"Monsters"}),e.jsx(y,{children:t.map(n=>e.jsx(j,{monster:o.includes(S(n))?void 0:n,onClick:()=>x(S(n))},S(n)))})]})}function Re({opened:s,onClose:r}){var a;const t=p(m=>m.player),o=((a=t==null?void 0:t.items[de])==null?void 0:a.count)??0,l=()=>{p.setState(m=>{m.player&&xe(m.player)})},i=()=>t?ue():!1;return e.jsx(U,{opened:s,onClose:r,header:e.jsx(R,{emoji:"🏆",count:o}),children:e.jsx(b,{h:"100%",children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsx(v,{label:"Arena"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsx(C,{emoji:"🏟",size:100}),e.jsx(h,{onClick:l,disabled:!i(),children:"Reset Battles"})]}),t==null?void 0:t.map.arena.dates.map(m=>e.jsx(Me,{date:m},m))]})})})}function Me({date:s}){var m,f;const r=p(x=>x.player),t=r?Object.values(O.arena.getLineup(r,{date:s})).filter(Boolean):void 0,o=r?O.arena.getRewards(r,{date:s}):void 0,l=Q(t),i=((f=(m=o==null?void 0:o.filter(x=>x.item&&x.item.id==="ot_arena_trophy")[0])==null?void 0:m.item)==null?void 0:f.count)??0,a=()=>{p.getState().player&&M.setState(c=>{c.modals.lineup={opened:!0,battleId:"arena"}})};return e.jsx(A,{withBorder:!0,radius:"md",children:e.jsxs(u,{direction:"column",gap:"md",children:[e.jsxs(u,{justify:"space-between",children:[e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(C,{emoji:"⚡"}),e.jsx(_,{order:5,children:V(l)})]}),e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(C,{emoji:"🏆"}),e.jsx(_,{order:5,c:"green",children:`+${i}`}),e.jsx(me,{children:"|"}),e.jsx(C,{emoji:"🏆"}),e.jsx(_,{order:5,c:"red",children:`-${i}`})]})]}),e.jsx(u,{style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(b,{children:e.jsx(u,{gap:"xs",children:t==null?void 0:t.map(x=>e.jsx(j,{monster:x},S(x)))})})}),e.jsx(h,{onClick:a,children:"Battle"})]})})}function Fe(){const[s,{open:r,close:t}]=D(),[o,{open:l,close:i}]=D(),[a,{open:m,close:f}]=D(),[x,{open:c,close:n}]=D();return e.jsxs(e.Fragment,{children:[e.jsx(b,{children:e.jsxs(u,{direction:"column",gap:"md",children:[e.jsx(T,{emoji:"🗼",title:"Tower",onClick:r}),e.jsx(T,{emoji:"🏟",title:"Arena",onClick:l}),e.jsx(T,{emoji:"⚒",title:"Blacksmith",onClick:m}),e.jsx(T,{emoji:"🪦",title:"Altar",onClick:c})]})}),e.jsx(be,{opened:s,onClose:t}),e.jsx(Re,{opened:o,onClose:i}),e.jsx(Ie,{opened:a,onClose:f}),e.jsx(ye,{opened:x,onClose:n})]})}export{Fe as default};
