import{f as z,u as B,R as G,g as R,a as E,s as p,b as f,v as g,c as A,d as F,e as b,h as L,i as h,j as P,k as _,r as N,l as e,F as o,T as v,D as u,E as l,m as q,n as H,B as S,C as Q,o as T,p as U,q as w,t as W,w as k}from"./index--tMnp0QA.js";import{C as I}from"./ContentAsset-JGabO6BC.js";import{C as x}from"./ContentList-TFwDcSQv.js";import{S as J}from"./ScrollArea-eUr5KL0o.js";import{I as y}from"./InputBase-YDnslzQE.js";const K={},C=z((s,i)=>{const t=B("TextInput",K,s);return G.createElement(y,{component:"input",ref:i,...t,__staticSelector:"TextInput"})});C.classes=y.classes;C.displayName="@mantine/core/TextInput";function $(s,i){var r,a;let t,n=0,c=((r=s.items[R])==null?void 0:r.count)??0,d=((a=s.items[E])==null?void 0:a.count)??0;switch(i.shop){case"gold":if(t=f[i.index],n=s.shop.gold[i.index]??0,!t||(t.price.gold??0)>c)return!1;break;case"gem":if(t=p[i.index],n=s.shop.gem[i.index]??0,!t||(t.price.gem??0)>d)return!1;break;default:return!0}return!(g===s.shop.snapshot&&t.limit>0&&t.limit<=n)}function M(s,i){if(!$(s,i))return;g!==s.shop.snapshot&&(s.shop={snapshot:g,startDate:Date.now(),premium:{},gold:{},gem:{}});let t,n=[];switch(i.shop){case"gold":t=f[i.index],n.push({item:F((t==null?void 0:t.price.gold)??0)});break;case"gem":t=p[i.index],n.push({item:A((t==null?void 0:t.price.gem)??0)});break}t&&(s.shop[i.shop][i.index]||(s.shop[i.shop][i.index]=0),s.shop[i.shop][i.index]++,b(s,{toRemove:n}),b(s,{toAdd:[{item:t.item}]}),L.buyShopItem.dispatch({player:s}))}function O(s,i){const t=new Date,n=new Date(X(s.shop.startDate));return!(t.getTime()<n.getTime())}function V(s,i){O(s)&&(s.shop={snapshot:g,startDate:Date.now(),premium:{},gold:{},gem:{}})}function X(s){const i=new Date(s);return i.setUTCHours(23,59,59),i.getTime()}function ne(){const s=h(r=>r.player),i=s?P(s.events.dailyQuests.startDate):Date.now(),t=_(i,()=>{h.setState(r=>{r.player&&V(r.player)})}),[n,c]=N.useState(""),d=()=>{};return e.jsx(J,{scrollbars:"y",children:e.jsxs(o,{direction:"column",gap:"md",children:[e.jsxs(v,{order:6,ta:"center",children:["Shop resets in ",t]}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"✨",size:16})," Special Offer"]})}),e.jsx(Y,{specialOffer:q,onBuy:()=>{}}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"👑",size:16})," Premium Shop"]})}),e.jsx(x,{gap:"xs",children:H.map((r,a)=>e.jsx(j,{shop:"premium",index:a,shopItem:r},a))}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"🪙",size:16})," Gold Shop"]})}),e.jsx(x,{gap:"xs",children:f.map((r,a)=>e.jsx(j,{shop:"gold",index:a,shopItem:r},a))}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"💎",size:16})," Gem Shop"]})}),e.jsx(x,{gap:"xs",children:p.map((r,a)=>e.jsx(j,{shop:"gem",index:a,shopItem:r},a))}),e.jsx(u,{label:e.jsxs(o,{align:"center",children:[e.jsx(l,{emoji:"🎁",size:16})," Gift Codes"]})}),e.jsxs(o,{align:"center",gap:"xs",mx:"auto",w:"100%",maw:300,children:[e.jsx(C,{placeholder:"Enter gift code...",value:n,onChange:r=>c(r.currentTarget.value),style:{flex:1}}),e.jsx(S,{onClick:d,children:"Redeem"})]})]})})}function Y({specialOffer:s,onBuy:i}){const t=n=>{k.setState(c=>{c.modals.itemDetails={opened:!0,item:n}})};return e.jsx(Q,{withBorder:!0,styles:{root:{backgroundImage:"url(/idle-demo/gggrain.svg)"}},children:e.jsxs(o,{direction:"column",align:"center",gap:"xs",children:[e.jsx(I,{size:100,image:s.asset.image,emoji:s.asset.emoji}),e.jsx(v,{order:3,c:"white",children:s.name}),e.jsx(o,{direction:"column",w:"100%",children:e.jsx(x,{gap:"xs",children:s.items.map(n=>e.jsx(T,{item:n,onClick:()=>t(n)},U(n)))})}),e.jsx(S,{w:"100%",maw:128,onClick:i,children:`Buy for $${s.money}`})]})})}function j({shop:s,index:i,shopItem:t}){const n=h(m=>m.player),c=()=>{k.setState(m=>{m.modals.itemDetails={opened:!0,item:t.item}})},d=()=>{h.setState(m=>{m.player&&M(m.player,{shop:s,index:i})})},r=()=>n?$(n,{shop:s,index:i}):!1,D=n?t.limit-(n.shop[s][i]??0):t.limit;return e.jsxs(o,{direction:"column",align:"center",w:64,children:[e.jsx(T,{item:t.item,onClick:c}),e.jsxs(S,{fullWidth:!0,size:"compact-sm",px:0,mt:"xs",onClick:d,disabled:!r(),children:[t.price.money!==void 0&&e.jsxs(e.Fragment,{children:["$",t.price.money]}),t.price.gem!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{emoji:"💎"})," ",w(t.price.gem)]}),t.price.gold!==void 0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{emoji:"🪙"})," ",w(t.price.gold)]})]}),e.jsx(W,{size:"xs",my:"xs",children:`Limit ${D<0?"∞":D}`})]})}export{ne as default};
