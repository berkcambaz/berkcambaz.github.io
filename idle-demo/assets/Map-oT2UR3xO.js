import{a4 as Z,an as q,ao as P,e as b,ap as ee,a8 as C,aq as te,ar as G,as as N,at as L,au as ne,av as U,aw as H,u as f,g as W,ax as $,j as e,ay as B,F as u,C as A,D as g,l as x,E as y,ad as F,B as p,m as h,q as v,p as R,r as I,az as E,aA as se,T,aB as re,aC as w,aD as oe,aE as ie,n as le,o as ae}from"./index-LKG6ecAX.js";import{F as O,R as D}from"./FullscreenModal-6M83FpiP.js";import{S}from"./ScrollArea-MB6Bf0Xn.js";import{C as k}from"./ContentList-NdGfWjdq.js";import{u as M}from"./use-disclosure-dSY4HeaO.js";var ce=Z("arrow-big-down-filled","IconArrowBigDownFilled",[["path",{d:"M10 2l-.15 .005a2 2 0 0 0 -1.85 1.995v6.999l-2.586 .001a2 2 0 0 0 -1.414 3.414l6.586 6.586a2 2 0 0 0 2.828 0l6.586 -6.586a2 2 0 0 0 .434 -2.18l-.068 -.145a2 2 0 0 0 -1.78 -1.089l-2.586 -.001v-6.999a2 2 0 0 0 -2 -2h-4z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]);function de(n,r){return!0}function me(n,r){const t=Date.now();n.map.arena.dates=[t,t+1,t+2]}function J(n,r){const t=n.items[r.itemId];return!(!t||t.count<=0)}function ue(n,r){if(!J(n,r))return;const t=n.items[r.itemId];if(!t)return;const l=Object.keys(te),o=q({seed:Date.now()},l.map(c=>({result:c,percent:1/P[c].index})));if(!o)return;const a={id:o,tier:t.tier,stars:t.stars,count:1};return b(n,{toRemove:[{item:ee(t.tier,t.stars,1)}],toAdd:[{item:a}]}),C.unlockItem.dispatch({player:n}),a}function K(n,r){const t=n.items[r.itemId];return!(!t||t.count<3||t.tier==="S"&&t.stars>=5)}function xe(n,r){if(!K(n,r))return;const t=n.items[r.itemId];if(!t)return;const l=G(t);l&&(b(n,{toAdd:[{item:l}],toRemove:[{item:{id:t.id,tier:t.tier,stars:t.stars,count:3}}]}),C.upgradeItem.dispatch({player:n}))}function Q(n,r){return r.items.map(l=>n.items[l]).filter(Boolean).length!==0}function je(n,r){if(!Q(n,r))return!1;const t=r.items.map(a=>n.items[a]).filter(Boolean),l=N(t),o=t.map(a=>({item:a}));return b(n,{toAdd:l,toRemove:o}),C.sellItem.dispatch({player:n}),!0}function V(n,r){const t=n.items[r.itemId];return!(!t||t.count<=0)}function fe(n,r){if(!V(n,r))return;const t=n.items[r.itemId];if(!t)return;const l=Object.keys(L),o=q({seed:Date.now()},l.map(c=>({result:c,percent:1/L[c].index})));if(!o)return;const a={id:o,stars:t.stars,level:1,time:Date.now()};return b(n,{toRemove:[{item:ne(t.stars,1)}],toAdd:[{monster:a}]}),C.summonMonster.dispatch({player:n}),a}function X(n,r){const t=r.monsters.map(o=>n.monsters[o]);return!!U(t)}function pe(n,r){if(!X(n,r))return!1;const t=r.monsters.map(m=>n.monsters[m]),l=U(t);if(!l)return!1;const o=t[0],a=t[1],c=t[2];return!o||!a||!c?!1:(b(n,{toAdd:[{monster:l},...Object.values({...a==null?void 0:a.items,...c==null?void 0:c.items}).map(m=>({item:m}))],toRemove:[{monster:o},{monster:a},{monster:c}]}),C.evolveMonster.dispatch({player:n}),!0)}function Y(n,r){return r.monsters.map(l=>n.monsters[l]).filter(Boolean).length!==0}function he(n,r){if(!Y(n,r))return!1;const t=r.monsters.map(c=>n.monsters[c]).filter(Boolean),l=t.map(c=>({monster:c})),o=[],a=H(t);return t.forEach(c=>{Object.values(c.items??{}).forEach(m=>{o.push({item:m})})}),b(n,{toAdd:[...o,...a],toRemove:l}),C.sacrificeMonsters.dispatch({player:n}),!0}function ge({opened:n,onClose:r}){var j;const t=f(i=>i.player),l=((j=t==null?void 0:t.items[W])==null?void 0:j.count)??0,o=(t==null?void 0:t.map.tower.stage)??0,a=t?Object.values($.tower.getLineup(t)).filter(Boolean):void 0,c=t?$.tower.getRewards(t):void 0,m=()=>{f.getState().player&&R.setState(s=>{s.modals.lineup={opened:!0,battleId:"tower"}})};return e.jsx(O,{opened:n,onClose:r,header:e.jsx(B,{emoji:"ü™ô",count:l}),children:e.jsxs(u,{direction:"column",align:"center",justify:"center",gap:"md",h:"100%",children:[e.jsx(A,{withBorder:!0,radius:"md",w:"100%",maw:360,children:e.jsxs(u,{direction:"column",gap:"xs",children:[e.jsx(g,{label:"Stage Enemies"}),e.jsx(S,{children:e.jsx(u,{gap:"xs",children:a==null?void 0:a.map((i,s)=>e.jsx(x,{monster:i},s))})})]})}),e.jsx(y,{emoji:"üóº",size:100}),e.jsx(F.Root,{size:"xl",w:"100%",maw:100,children:e.jsx(F.Section,{value:100,striped:!0,animated:!0,children:e.jsx(F.Label,{pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%",overflow:"visible"},children:`Stage ${o+1}`})})}),e.jsx(p,{size:"md",onClick:m,children:"Battle"}),e.jsx(A,{withBorder:!0,radius:"md",w:"100%",maw:360,children:e.jsxs(u,{direction:"column",gap:"xs",children:[e.jsx(g,{label:"Stage Rewards"}),e.jsx(S,{children:e.jsx(u,{gap:"xs",children:c==null?void 0:c.map(i=>i.item?e.jsx(x,{item:i.item},h(i.item)):e.jsx(x,{monster:i.monster},v(i.monster)))})})]})})]})})}function ve({opened:n,onClose:r}){var c;const[t,l]=I.useState("upgrade"),o=f(m=>m.player),a=((c=o==null?void 0:o.items[W])==null?void 0:c.count)??0;return e.jsx(O,{opened:n,onClose:r,header:e.jsx(B,{emoji:"ü™ô",count:a}),children:e.jsx(A,{withBorder:!0,radius:"md",h:"100%",children:e.jsx(S,{children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsxs(p.Group,{mx:"auto",w:"100%",maw:360,children:[e.jsx(p,{fullWidth:!0,px:0,variant:t!=="unlock"?"default":void 0,onClick:()=>l("unlock"),children:"Unlock"}),e.jsx(p,{fullWidth:!0,px:0,variant:t!=="upgrade"?"default":void 0,onClick:()=>l("upgrade"),children:"Upgrade"}),e.jsx(p,{fullWidth:!0,px:0,variant:t!=="sell"?"default":void 0,onClick:()=>l("sell"),children:"Sell"})]}),t==="unlock"&&e.jsx(Se,{}),t==="upgrade"&&e.jsx(Ie,{}),t==="sell"&&e.jsx(be,{})]})})})})}function Se(){const n=f(i=>i.player),[r,t]=I.useState(void 0),l=n&&r?n.items[r]:void 0,o=n?Object.values(n.items).filter(i=>i.id==="ot_item_box"):void 0,a=()=>{let i;f.setState(s=>{s.player&&r&&(i=ue(s.player,{itemId:r}))}),i&&R.setState(s=>{s.modals.contentList={opened:!0,contents:[{item:i}],onClick(){R.setState(d=>{d.modals.itemDetails={opened:!0,item:i}})}}})},c=()=>!n||!r?!1:J(n,{itemId:r}),m=i=>{t(i)},j=()=>{t(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Unlock Items"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsx(x,{item:l,onClick:j}),e.jsx(p,{onClick:a,disabled:!c(),children:"Unlock"})]}),e.jsx(g,{label:"Item Boxes"}),e.jsx(k,{children:o==null?void 0:o.map(i=>e.jsx(x,{item:r!==h(i)?i:void 0,onClick:()=>m(h(i))},h(i)))})]})}function Ie(){const n=f(d=>d.player),[r,t]=I.useState(void 0),l=n&&r?n.items[r]:void 0,o=l?G(l):void 0,a=n?Object.values(n.items).filter(d=>P[d.id].type!=="other"):void 0,c=()=>{f.setState(d=>{d.player&&r&&xe(d.player,{itemId:r})})},m=()=>!n||!r?!1:K(n,{itemId:r}),j=d=>{t(d)},i=()=>{t(void 0)},s=()=>Math.min((l==null?void 0:l.count)??0,3);return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Upgrade Items"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsxs(u,{align:"center",gap:"md",pos:"relative",children:[e.jsx(x,{placeholder:E("we_ancient_sword").image,item:l,onClick:i}),e.jsx(se,{}),e.jsx(T,{order:5,mt:48,pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%"},children:`${s()} / 3`}),e.jsx(x,{placeholder:E("we_broad_axe_5").image,item:o})]}),e.jsx(p,{onClick:c,disabled:!m(),children:"Upgrade"})]}),e.jsx(g,{label:"Items"}),e.jsx(k,{children:a==null?void 0:a.map(d=>e.jsx(x,{item:r!==h(d)?d:void 0,onClick:()=>j(h(d))},h(d)))})]})}function be(){const n=f(s=>s.player),r=n?Object.values(n.items):void 0,[t,l]=I.useState([]),o=n?t.map(s=>s?n.items[s]:void 0).filter(Boolean):void 0,a=o?N(o):[],c=()=>{f.setState(s=>{if(!s.player||!o)return;je(s.player,{items:t})&&l([])})},m=()=>!n||!o?!1:Q(n,{items:t}),j=s=>{t.filter(d=>d===s).length>0||l([...t,s])},i=s=>{const d=[...t];d.splice(s,1),l(d)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Sell Items"}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(S,{scrollbars:"x",children:e.jsxs(u,{justify:"center",gap:"xs",children:[t.length===0&&e.jsx(x,{placeholder:E("we_ancient_sword").image}),o==null?void 0:o.map((s,d)=>e.jsx(x,{item:s,onClick:()=>i(d)},h(s)))]})})}),e.jsx(u,{justify:"center",children:e.jsx(p,{onClick:c,disabled:!m(),variant:"light",color:"red",children:"Sell & Receive"})}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(S,{scrollbars:"x",children:e.jsx(u,{justify:"center",gap:"xs",children:a==null?void 0:a.map(s=>s.item?e.jsx(x,{item:s.item},h(s.item)):e.jsx(x,{monster:s.monster},v(s.monster)))})})}),e.jsx(g,{label:"Items"}),e.jsx(k,{children:r==null?void 0:r.map(s=>e.jsx(x,{item:t.includes(h(s))?void 0:s,onClick:()=>j(h(s))},h(s)))})]})}function Ce({opened:n,onClose:r}){var m,j;const[t,l]=I.useState("evolve"),o=f(i=>i.player),a=((m=o==null?void 0:o.items[W])==null?void 0:m.count)??0,c=((j=o==null?void 0:o.items[re])==null?void 0:j.count)??0;return e.jsx(O,{opened:n,onClose:r,header:e.jsxs(e.Fragment,{children:[e.jsx(B,{emoji:"ü™ô",count:a}),e.jsx(B,{emoji:"üçè",count:c})]}),children:e.jsx(A,{withBorder:!0,radius:"md",h:"100%",children:e.jsx(S,{scrollbars:"y",h:"100%",children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsxs(p.Group,{mx:"auto",w:"100%",maw:360,children:[e.jsx(p,{fullWidth:!0,px:0,variant:t!=="summon"?"default":void 0,onClick:()=>l("summon"),children:"Summon"}),e.jsx(p,{fullWidth:!0,px:0,variant:t!=="evolve"?"default":void 0,onClick:()=>l("evolve"),children:"Evolve"}),e.jsx(p,{fullWidth:!0,px:0,variant:t!=="sacrifice"?"default":void 0,onClick:()=>l("sacrifice"),children:"Sacrifice"})]}),t==="summon"&&e.jsx(ke,{}),t==="evolve"&&e.jsx(we,{}),t==="sacrifice"&&e.jsx(ye,{})]})})})})}function ke(){const n=f(i=>i.player),[r,t]=I.useState(void 0),l=n&&r?n.items[r]:void 0,o=n?Object.values(n.items).filter(i=>i.id==="ot_monster_scroll"):void 0,a=()=>{let i;f.setState(s=>{s.player&&r&&(i=fe(s.player,{itemId:r}))}),i&&R.setState(s=>{s.modals.contentList={opened:!0,contents:[{monster:i}]}})},c=()=>!n||!r?!1:V(n,{itemId:r}),m=i=>{t(i)},j=()=>{t(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Summon Monsters"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsx(x,{item:l,onClick:j}),e.jsx(p,{onClick:a,disabled:!c(),children:"Summon"})]}),e.jsx(g,{label:"Monster Scrolls"}),e.jsx(k,{children:o==null?void 0:o.map(i=>e.jsx(x,{item:r!==h(i)?i:void 0,onClick:()=>m(h(i))},h(i)))})]})}function we(){const n=f(s=>s.player),r=n?Object.values(n.monsters):void 0,[t,l]=I.useState([void 0,void 0,void 0]),o=n?t.map(s=>s?n.monsters[s]:void 0):void 0,a=o?U(o):void 0,c=()=>{f.setState(s=>{if(!s.player||t.filter(Boolean).length<3)return;pe(s.player,{monsters:t})&&l([void 0,void 0,void 0])})},m=()=>!n||t.filter(Boolean).length<3?!1:X(n,{monsters:t}),j=s=>{if(t.filter(_=>_===s).length>0)return;const d=t.findIndex(_=>_===void 0);if(d===-1)return;const z=[...t];z.splice(d,1,s),l(z)},i=s=>{const d=[...t];d[s]=void 0,l(d)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Evolve Monsters"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(x,{placeholder:w("angel"),monster:o==null?void 0:o[0],onClick:()=>i(0)}),e.jsx(x,{placeholder:w("angel"),monster:o==null?void 0:o[1],onClick:()=>i(1)}),e.jsx(x,{placeholder:w("angel"),monster:o==null?void 0:o[2],onClick:()=>i(2)})]}),e.jsx(ce,{}),e.jsx(x,{placeholder:w("death_knight"),monster:a}),e.jsx(p,{onClick:c,disabled:!m(),children:"Upgrade"})]}),e.jsx(g,{label:"Monsters"}),e.jsx(k,{children:r==null?void 0:r.map(s=>e.jsx(x,{monster:t.includes(v(s))?void 0:s,onClick:()=>j(v(s))},v(s)))})]})}function ye(){const n=f(s=>s.player),r=n?Object.values(n.monsters):void 0,[t,l]=I.useState([]),o=n?t.map(s=>s?n.monsters[s]:void 0).filter(Boolean):void 0,a=o?H(o):[],c=()=>{f.setState(s=>{if(!s.player||!o)return;he(s.player,{monsters:t})&&l([])})},m=()=>!n||!o?!1:Y(n,{monsters:t}),j=s=>{t.filter(d=>d===s).length>0||l([...t,s])},i=s=>{const d=[...t];d.splice(s,1),l(d)};return e.jsxs(e.Fragment,{children:[e.jsx(g,{label:"Sacrifice Monsters"}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(S,{scrollbars:"x",children:e.jsxs(u,{justify:"center",gap:"xs",children:[t.length===0&&e.jsx(x,{placeholder:w("angel")}),o==null?void 0:o.map((s,d)=>e.jsx(x,{monster:s,onClick:()=>i(d)},v(s)))]})})}),e.jsx(u,{justify:"center",children:e.jsx(p,{onClick:c,disabled:!m(),variant:"light",color:"red",children:"Sacrifice & Receive"})}),e.jsx(u,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(S,{scrollbars:"x",children:e.jsx(u,{justify:"center",gap:"xs",children:a==null?void 0:a.map(s=>s.item?e.jsx(x,{item:s.item},h(s.item)):e.jsx(x,{monster:s.monster},v(s.monster)))})})}),e.jsx(g,{label:"Monsters"}),e.jsx(k,{children:r==null?void 0:r.map(s=>e.jsx(x,{monster:t.includes(v(s))?void 0:s,onClick:()=>j(v(s))},v(s)))})]})}function Be({opened:n,onClose:r}){var c;const t=f(m=>m.player),l=((c=t==null?void 0:t.items[oe])==null?void 0:c.count)??0,o=()=>{f.setState(m=>{m.player&&me(m.player)})},a=()=>t?de():!1;return e.jsx(O,{opened:n,onClose:r,header:e.jsx(B,{emoji:"üèÜ",count:l}),children:e.jsx(S,{h:"100%",children:e.jsxs(u,{direction:"column",gap:"md",h:"100%",children:[e.jsx(g,{label:"Arena"}),e.jsxs(u,{direction:"column",align:"center",gap:"md",children:[e.jsx(y,{emoji:"üèü",size:100}),e.jsx(p,{onClick:o,disabled:!a(),children:"Reset Battles"})]}),t==null?void 0:t.map.arena.dates.map(m=>e.jsx(Ae,{date:m},m))]})})})}function Ae({date:n}){var m,j;const r=f(i=>i.player),t=r?Object.values($.arena.getLineup(r,{date:n})).filter(Boolean):void 0,l=r?$.arena.getRewards(r,{date:n}):void 0,o=ie(t),a=((j=(m=l==null?void 0:l.filter(i=>i.item&&i.item.id==="ot_arena_trophy")[0])==null?void 0:m.item)==null?void 0:j.count)??0,c=()=>{f.getState().player&&R.setState(s=>{s.modals.lineup={opened:!0,battleId:"arena"}})};return e.jsx(A,{withBorder:!0,radius:"md",children:e.jsxs(u,{direction:"column",gap:"md",children:[e.jsxs(u,{justify:"space-between",children:[e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(y,{emoji:"‚ö°"}),e.jsx(T,{order:5,children:le(o)})]}),e.jsxs(u,{align:"center",gap:"xs",children:[e.jsx(y,{emoji:"üèÜ"}),e.jsx(T,{order:5,c:"green",children:`+${a}`}),e.jsx(ae,{children:"|"}),e.jsx(y,{emoji:"üèÜ"}),e.jsx(T,{order:5,c:"red",children:`-${a}`})]})]}),e.jsx(u,{style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(S,{children:e.jsx(u,{gap:"xs",children:t==null?void 0:t.map(i=>e.jsx(x,{monster:i},v(i)))})})}),e.jsx(p,{onClick:c,children:"Battle"})]})})}function Oe(){const[n,{open:r,close:t}]=M(),[l,{open:o,close:a}]=M(),[c,{open:m,close:j}]=M(),[i,{open:s,close:d}]=M();return e.jsxs(e.Fragment,{children:[e.jsx(S,{children:e.jsxs(u,{direction:"column",gap:"md",children:[e.jsx(D,{emoji:"üóº",title:"Tower",onClick:r}),e.jsx(D,{emoji:"üèü",title:"Arena",onClick:o}),e.jsx(D,{emoji:"‚öí",title:"Blacksmith",onClick:m}),e.jsx(D,{emoji:"ü™¶",title:"Altar",onClick:s})]})}),e.jsx(ge,{opened:n,onClose:t}),e.jsx(Be,{opened:l,onClose:a}),e.jsx(ve,{opened:c,onClose:j}),e.jsx(Ce,{opened:i,onClose:d})]})}export{Oe as default};
