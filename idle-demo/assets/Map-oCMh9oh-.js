import{a1 as N,al as W,f as M,a5 as R,am as Q,an as U,ao as V,ap as O,aq as q,u as h,g as T,ar as z,j as e,as as y,F as m,C as A,D as p,k as u,E as X,aa as F,B as g,l as S,n as v,o as G,r as C,at as Y,au as L,av as Z,T as ee,aw as te,ax as w,m as se}from"./index-8ppehLxy.js";import{F as $,R as B}from"./FullscreenModal-r4zo4MKw.js";import{S as I}from"./ScrollArea-e2MVZrqT.js";import{C as E}from"./ContentList-q1lpEh1_.js";import{u as D}from"./use-disclosure-fwGS97u4.js";var ne=N("arrow-big-down-filled","IconArrowBigDownFilled",[["path",{d:"M10 2l-.15 .005a2 2 0 0 0 -1.85 1.995v6.999l-2.586 .001a2 2 0 0 0 -1.414 3.414l6.586 6.586a2 2 0 0 0 2.828 0l6.586 -6.586a2 2 0 0 0 .434 -2.18l-.068 -.145a2 2 0 0 0 -1.78 -1.089l-2.586 -.001v-6.999a2 2 0 0 0 -2 -2h-4z",fill:"currentColor",key:"svg-0",strokeWidth:"0"}]]);function P(s,r){const t=s.items[r.itemId];return!(!t||t.count<3||t.tier==="S"&&t.stars>=5)}function oe(s,r){if(!P(s,r))return;const t=s.items[r.itemId];if(!t)return;const i=W(t);i&&(M(s,{toAdd:[{item:i}],toRemove:[{item:{id:t.id,tier:t.tier,stars:t.stars,count:3}}]}),R.upgradeItem.dispatch({player:s}))}function H(s,r){const t=s.items[r.itemId];return!(!t||t.count<=0)}function re(s,r){if(!H(s,r))return;const t=s.items[r.itemId];if(!t)return;const i=Object.keys(U),o=Q({seed:Date.now()},i.map(c=>({result:c,percent:1/U[c].index})));if(!o)return;const a={id:o,stars:t.stars,level:1,time:Date.now()};return M(s,{toRemove:[{item:V(t.stars,1)}],toAdd:[{monster:a}]}),R.summonMonster.dispatch({player:s}),a}function J(s,r){const t=r.monsters.map(o=>s.monsters[o]);return!!O(t)}function ie(s,r){if(!J(s,r))return!1;const t=r.monsters.map(d=>s.monsters[d]),i=O(t);if(!i)return!1;const o=t[0],a=t[1],c=t[2];return!o||!a||!c?!1:(M(s,{toAdd:[{monster:i},...Object.values({...a==null?void 0:a.items,...c==null?void 0:c.items}).map(d=>({item:d}))],toRemove:[{monster:o},{monster:a},{monster:c}]}),R.evolveMonster.dispatch({player:s}),!0)}function K(s,r){return r.monsters.map(i=>s.monsters[i]).filter(Boolean).length!==0}function le(s,r){if(!K(s,r))return!1;const t=r.monsters.map(c=>s.monsters[c]).filter(Boolean),i=t.map(c=>({monster:c})),o=[],a=q(t);return t.forEach(c=>{Object.values(c.items??{}).forEach(d=>{o.push({item:d})})}),M(s,{toAdd:[...o,...a],toRemove:i}),R.sacrificeMonsters.dispatch({player:s}),!0}function ae({opened:s,onClose:r}){var x;const t=h(l=>l.player),i=((x=t==null?void 0:t.items[T])==null?void 0:x.count)??0,o=(t==null?void 0:t.map.tower.stage)??0,a=t?Object.values(z.tower.getLineup(t)).filter(Boolean):void 0,c=t?z.tower.getRewards(t):void 0,d=()=>{h.getState().player&&G.setState(n=>{n.modals.lineup={opened:!0,battleId:"tower"}})};return e.jsx($,{opened:s,onClose:r,header:e.jsx(y,{emoji:"🪙",count:i}),children:e.jsxs(m,{direction:"column",align:"center",justify:"center",gap:"md",h:"100%",children:[e.jsx(A,{withBorder:!0,radius:"md",w:"100%",maw:360,children:e.jsxs(m,{direction:"column",gap:"xs",children:[e.jsx(p,{label:"Stage Enemies"}),e.jsx(I,{children:e.jsx(m,{gap:"xs",children:a==null?void 0:a.map((l,n)=>e.jsx(u,{monster:l},n))})})]})}),e.jsx(X,{emoji:"🗼",size:100}),e.jsx(F.Root,{size:"xl",w:"100%",maw:100,children:e.jsx(F.Section,{value:100,striped:!0,animated:!0,children:e.jsx(F.Label,{pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%",overflow:"visible"},children:`Stage ${o+1}`})})}),e.jsx(g,{size:"md",onClick:d,children:"Battle"}),e.jsx(A,{withBorder:!0,radius:"md",w:"100%",maw:360,children:e.jsxs(m,{direction:"column",gap:"xs",children:[e.jsx(p,{label:"Stage Rewards"}),e.jsx(I,{children:e.jsx(m,{gap:"xs",children:c==null?void 0:c.map(l=>l.item?e.jsx(u,{item:l.item},S(l.item)):e.jsx(u,{monster:l.monster},v(l.monster)))})})]})})]})})}function ce({opened:s,onClose:r}){var _;const t=h(j=>j.player),[i,o]=C.useState(void 0),a=t&&i?t.items[i]:void 0,c=a?W(a):void 0,d=((_=t==null?void 0:t.items[T])==null?void 0:_.count)??0,x=t?Object.values(t.items).filter(j=>Y[j.id].type!=="other"):void 0,l=()=>{h.setState(j=>{j.player&&i&&oe(j.player,{itemId:i})})},n=()=>!t||!i?!1:P(t,{itemId:i}),f=j=>{o(j)},k=()=>{o(void 0)},b=()=>Math.min((a==null?void 0:a.count)??0,3);return e.jsx($,{opened:s,onClose:r,header:e.jsx(y,{emoji:"🪙",count:d}),children:e.jsx(A,{withBorder:!0,radius:"md",h:"100%",children:e.jsx(I,{children:e.jsxs(m,{direction:"column",gap:"md",h:"100%",children:[e.jsx(p,{label:"Upgrade Items"}),e.jsxs(m,{direction:"column",align:"center",gap:"md",children:[e.jsxs(m,{align:"center",gap:"md",pos:"relative",children:[e.jsx(u,{placeholder:L("we_ancient_sword").image,item:a,onClick:k}),e.jsx(Z,{}),e.jsx(ee,{order:5,mt:48,pos:"absolute",style:{transform:"translate(-50%,0)",left:"50%"},children:`${b()} / 3`}),e.jsx(u,{placeholder:L("we_broad_axe_5").image,item:c})]}),e.jsx(g,{onClick:l,disabled:!n(),children:"Upgrade"})]}),e.jsx(p,{label:"Items"}),e.jsx(E,{children:x==null?void 0:x.map(j=>e.jsx(u,{item:i!==S(j)?j:void 0,onClick:()=>f(S(j))},S(j)))})]})})})})}function de({opened:s,onClose:r}){var d,x;const[t,i]=C.useState("summon"),o=h(l=>l.player),a=((d=o==null?void 0:o.items[T])==null?void 0:d.count)??0,c=((x=o==null?void 0:o.items[te])==null?void 0:x.count)??0;return e.jsx($,{opened:s,onClose:r,header:e.jsxs(e.Fragment,{children:[e.jsx(y,{emoji:"🪙",count:a}),e.jsx(y,{emoji:"🍏",count:c})]}),children:e.jsx(A,{withBorder:!0,radius:"md",h:"100%",children:e.jsx(I,{scrollbars:"y",h:"100%",children:e.jsxs(m,{direction:"column",gap:"md",h:"100%",children:[e.jsxs(g.Group,{mx:"auto",w:"100%",maw:360,children:[e.jsx(g,{fullWidth:!0,px:0,variant:t!=="summon"?"default":void 0,onClick:()=>i("summon"),children:"Summon"}),e.jsx(g,{fullWidth:!0,px:0,variant:t!=="evolve"?"default":void 0,onClick:()=>i("evolve"),children:"Evolve"}),e.jsx(g,{fullWidth:!0,px:0,variant:t!=="sacrifice"?"default":void 0,onClick:()=>i("sacrifice"),children:"Sacrifice"})]}),t==="summon"&&e.jsx(me,{}),t==="evolve"&&e.jsx(ue,{}),t==="sacrifice"&&e.jsx(xe,{})]})})})})}function me(){const s=h(l=>l.player),[r,t]=C.useState(void 0),i=s&&r?s.items[r]:void 0,o=s?Object.values(s.items).filter(l=>l.id==="ot_monster_scroll"):void 0,a=()=>{let l;h.setState(n=>{n.player&&r&&(l=re(n.player,{itemId:r}))}),l&&G.setState(n=>{n.modals.contentList={opened:!0,contents:[{monster:l}]}})},c=()=>!s||!r?!1:H(s,{itemId:r}),d=l=>{t(l)},x=()=>{t(void 0)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Summon Monsters"}),e.jsxs(m,{direction:"column",align:"center",gap:"md",children:[e.jsx(u,{item:i,onClick:x}),e.jsx(g,{onClick:a,disabled:!c(),children:"Summon"})]}),e.jsx(p,{label:"Monster Scrolls"}),e.jsx(E,{children:o==null?void 0:o.map(l=>e.jsx(u,{item:l,onClick:()=>d(S(l))},S(l)))})]})}function ue(){const s=h(n=>n.player),r=s?Object.values(s.monsters):void 0,[t,i]=C.useState([void 0,void 0,void 0]),o=s?t.map(n=>n?s.monsters[n]:void 0):void 0,a=o?O(o):void 0,c=()=>{h.setState(n=>{if(!n.player||t.filter(Boolean).length<3)return;ie(n.player,{monsters:t})&&i([void 0,void 0,void 0])})},d=()=>!s||t.filter(Boolean).length<3?!1:J(s,{monsters:t}),x=n=>{if(t.filter(b=>b===n).length>0)return;const f=t.findIndex(b=>b===void 0);if(f===-1)return;const k=[...t];k.splice(f,1,n),i(k)},l=n=>{const f=[...t];f[n]=void 0,i(f)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Evolve Monsters"}),e.jsxs(m,{direction:"column",align:"center",gap:"md",children:[e.jsxs(m,{align:"center",gap:"xs",children:[e.jsx(u,{placeholder:w("angel"),monster:o==null?void 0:o[0],onClick:()=>l(0)}),e.jsx(u,{placeholder:w("angel"),monster:o==null?void 0:o[1],onClick:()=>l(1)}),e.jsx(u,{placeholder:w("angel"),monster:o==null?void 0:o[2],onClick:()=>l(2)})]}),e.jsx(ne,{}),e.jsx(u,{placeholder:w("death_knight"),monster:a}),e.jsx(g,{onClick:c,disabled:!d(),children:"Upgrade"})]}),e.jsx(p,{label:"Monsters"}),e.jsx(E,{children:r==null?void 0:r.map(n=>e.jsx(u,{monster:t.includes(v(n))?void 0:n,onClick:()=>x(v(n))},v(n)))})]})}function xe(){const s=h(n=>n.player),r=s?Object.values(s.monsters):void 0,[t,i]=C.useState([]),o=s?t.map(n=>n?s.monsters[n]:void 0).filter(Boolean):void 0,a=o?q(o):[],c=()=>{h.setState(n=>{if(!n.player||!o)return;le(n.player,{monsters:t})&&i([])})},d=()=>!s||!o?!1:K(s,{monsters:t}),x=n=>{t.filter(f=>f===n).length>0||i([...t,n])},l=n=>{const f=[...t];f.splice(n,1),i(f)};return e.jsxs(e.Fragment,{children:[e.jsx(p,{label:"Sacrifice Monsters"}),e.jsx(m,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(I,{scrollbars:"x",children:e.jsxs(m,{justify:"center",gap:"xs",children:[t.length===0&&e.jsx(u,{placeholder:w("angel")}),o==null?void 0:o.map((n,f)=>e.jsx(u,{monster:n,onClick:()=>l(f)},v(n)))]})})}),e.jsx(m,{justify:"center",children:e.jsx(g,{onClick:c,disabled:!d(),variant:"light",color:"red",children:"Sacrifice & Receive"})}),e.jsx(m,{direction:"column",style:{display:"grid",gridTemplateColumns:"auto"},children:e.jsx(I,{scrollbars:"x",children:e.jsx(m,{justify:"center",gap:"xs",children:a==null?void 0:a.map(n=>n.item?e.jsx(u,{item:n.item},S(n.item)):e.jsx(u,{monster:n.monster},v(n.monster)))})})}),e.jsx(p,{label:"Monsters"}),e.jsx(E,{children:r==null?void 0:r.map(n=>e.jsx(u,{monster:t.includes(v(n))?void 0:n,onClick:()=>x(v(n))},v(n)))})]})}function ge(){const[s,{open:r,close:t}]=D(),[i,{open:o,close:a}]=D(),[c,{open:d,close:x}]=D();return e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsxs(m,{direction:"column",gap:"md",children:[e.jsx(B,{emoji:"🗼",title:"Tower",onClick:r}),e.jsx(B,{emoji:"🏟",title:"Arena",onClick:()=>{},children:e.jsx(se,{ta:"left",size:"sm",c:"yellow",children:"Coming soon..."})}),e.jsx(B,{emoji:"⚒",title:"Blacksmith",onClick:o}),e.jsx(B,{emoji:"🪦",title:"Altar",onClick:d})]})}),e.jsx(ae,{opened:s,onClose:t}),e.jsx(ce,{opened:i,onClose:a}),e.jsx(de,{opened:c,onClose:x})]})}export{ge as default};
