var ae=Object.defineProperty;var se=(a,r,e)=>r in a?ae(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e;var M=(a,r,e)=>(se(a,typeof r!="symbol"?r+"":r,e),e);import{r as n,j as w,a as o,F as ne,b as G}from"./index.ec832975.js";import{m as g,g as l,u as d,U as $,T as ie,L as P,s as m,a as L,b as i}from"./Game.621b975a.js";class oe{constructor(r,e,s,c){this.id=r,this.spritesSmall=e,this.spritesBig=s,this.stats=c,this.id=r,this.spritesSmall=e,this.spritesBig=s,this.stats=c}getSpriteSmall(r){if(r===void 0)return;const e=this.spritesSmall[r];if(!!e)return e}getSpriteBig(r){if(r===void 0)return;const e=this.spritesBig[r];if(!!e)return e}getSpriteSmallSrc(r){const e=this.getSpriteSmall(r);return e?e.src:void 0}getSpriteBigSrc(r){const e=this.getSpriteBig(r);return e?e.src:void 0}update(r){!r.army||(r.army.acted||(r.army.morale+=.25),r.army.owner!==r.owner&&(r.army.morale-=.125),r.army.morale=g.clamp(r.army.morale,-3,1),r.army.acted=!1)}availableToRecruit(r){var s;const e=l.gameplay.currentCountry;return!(!e||e!==r.owner||r.army||!((s=r.landmark)!=null&&s.data.stats.recruitable))}canRecruit(r){return!(!r.isFree()||r.owner.gold<this.stats.gold||r.owner.manpower<r.owner.army+this.stats.manpower)}recruit(r){var e,s;!this.availableToRecruit(r)||!this.canRecruit(r)||(r.army=new T(this,r.owner),r.owner.gold-=this.stats.gold,this.addEffects(r),l.tilemap.drawTile(r),l.tilemap.showTiles((s=(e=l.tilemap.selectedTile)==null?void 0:e.army)==null?void 0:s.data.getMoves(l.tilemap.selectedTile)),d.getState().refreshCountry(),d.getState().refreshTile())}availableToDisband(r){var s;const e=l.gameplay.currentCountry;return!(!e||!r.army||e!==((s=r.army)==null?void 0:s.owner))}canDisband(r){const e=l.gameplay.currentCountry;return!(!e||e!==r.owner)}disband(r){!this.availableToDisband(r)||!this.canDisband(r)||(r.army=void 0,this.removeEffects(r),l.tilemap.drawTile(r),l.tilemap.showTiles([]),d.getState().refreshCountry(),d.getState().refreshTile())}availableToMove(r){const e=l.gameplay.currentCountry;return!(!e||!r.army||r.army.owner!==e)}canMove(r){var e;return!((e=r.army)!=null&&e.acted)}getMoves(r){if(!this.availableToMove(r)||!this.canMove(r))return[];let e=$.getAdjacentTiles(r);return e=e.filter(s=>{var c,y;return((c=s.army)==null?void 0:c.owner)!==((y=r.army)==null?void 0:y.owner)}),e}move(r,e){!r||!r.army||!e||!this.availableToMove(r)||!this.canMove(r)||!ie.includes(e,l.tilemap.shownTiles)||(P.logMove(r,e),r.army.acted=!0,e.army?this.attack(r,e):(e.army=r.army,r.army=void 0),l.tilemap.drawTile(r),l.tilemap.drawTile(e),d.getState().refreshCountry(),d.getState().refreshTile())}attack(r,e){if(!r.army||!e.army)return;const s=l.tilemap.srandom.dice(),c=l.tilemap.srandom.dice(),y=r.army.data.stats.offensive,B=e.army.data.stats.defensive,S=r.landmark?r.landmark.data.stats.offensive:0,k=e.landmark?e.landmark.data.stats.defensive:0,D=$.getSupportBonus(r),p=$.getSupportBonus(e),R=r.army.morale,A=e.army.morale,h=s+y+S+D+R,v=c+B+k+p+A;P.logAttack({allyDice:s,allyArmyBonus:y,allyLandmarkBonus:S,allySupportBonus:D,allyMorale:R,enemyDice:c,enemyArmyBonus:B,enemyLandmarkBonus:k,enemySupportBonus:p,enemyMorale:A,ally:h,enemy:v}),h>v?(r.army.morale=g.clamp(r.army.morale-.125,-3,1),this.removeEffects(e),e.army=r.army,r.army=void 0):h===v?(r.army.morale=g.clamp(r.army.morale-.25,-3,1),e.army.morale=g.clamp(e.army.morale-.25,-3,1)):v>h&&(e.army.morale=g.clamp(e.army.morale-.125,-3,1),this.removeEffects(r),r.army=void 0)}addEffects(r){r.owner.army+=this.stats.manpower}removeEffects(r){r.owner.army-=this.stats.manpower}onFree(r){}onOccupy(r){}onConquer(r){}}var f=(a=>(a[a.Basic=0]="Basic",a))(f||{});class le extends oe{constructor(){super(f.Basic,[m.armyGreenSmall,m.armyPurpleSmall,m.armyRedSmall,m.armyYellowSmall],[m.armyGreenBig,m.armyPurpleBig,m.armyRedBig,m.armyYellowBig],{gold:2,manpower:1,offensive:0,defensive:0,breakthrough:0})}}class T{constructor(r,e){M(this,"data");M(this,"owner");M(this,"morale",0);M(this,"acted",!1);this.data=r,this.owner=e}static get(r){switch(r){case f.Basic:return new le}}}const ce={name:"220rkc",styles:"color:#fff"},F={name:"eivff4",styles:"display:none"},j={name:"eqd9i9",styles:"background-color:rgb(128, 128, 128, 0.5)"},U={name:"pp2au",styles:"height:64px;position:absolute;left:0;right:0;display:flex;flex-direction:row;align-items:center;justify-content:center"},ue=G(U," top:0;background-image:linear-gradient(180deg,  rgba(0, 0, 0, 0.75) , rgba(0, 0, 0, 0));",""),me=G(U," bottom:0;background-image:linear-gradient(0deg,  rgba(0, 0, 0, 0.75) , rgba(0, 0, 0, 0));",""),de={name:"18jhpep",styles:"width:48px;height:48px"},O=G(ce," display:flex;flex-direction:column;align-items:center;&:nth-of-type(n){margin-right:1rem;}&:last-of-type{margin-right:0;}",""),C={name:"1fax00o",styles:"cursor:pointer;width:48px;height:48px;background-color:rgb(256, 256, 256, 0.5);border-radius:50%;&:hover{border:1px solid #fff;padding:1px;}&:nth-of-type(n){margin-right:1rem;}&:last-of-type{margin-right:0;}"};function fe(){var H,_,q;const a=d(t=>t.currentCountry),r=d(t=>t.refreshCurrentCountry),e=d(t=>t.currentTile),s=d(t=>t.refrestCurrentTile),c=d(t=>t.turn),y=n.exports.useMemo(()=>{if(!a)return;const t=T.get(f.Basic).spritesBig[a.id];if(!!t)return t.src},[a,r]),B=n.exports.useMemo(()=>{if(!a)return"-";const t=g.clamp(a.gold,-999,999),u=g.clamp(a.income,-999,999);return`${t} (${u>=0?"+":"-"}${u})`},[a,r]),S=n.exports.useMemo(()=>{if(!a)return"-";const t=g.clamp(a.army,0,999),u=g.clamp(a.manpower,0,999);return`${t} / ${u}`},[a,r]),k=n.exports.useMemo(()=>`${c>999?"+999":c}`,[c]),D=n.exports.useMemo(()=>t=>T.get(t).getSpriteBigSrc(a==null?void 0:a.id),[a,r]),p=n.exports.useMemo(()=>t=>L.get(t).getSpriteSrc(a==null?void 0:a.id),[a,r]),R=n.exports.useMemo(()=>t=>e?T.get(t).availableToRecruit(e):!1,[e,s]),A=n.exports.useMemo(()=>t=>e?T.get(t).canRecruit(e):!1,[e,s]),h=n.exports.useMemo(()=>t=>e?T.get(t).recruit(e):!1,[e,s]),v=n.exports.useMemo(()=>()=>{var t;return e?(t=e.army)==null?void 0:t.data.availableToDisband(e):!1},[e,s]),Y=n.exports.useMemo(()=>()=>{var t;return e?(t=e.army)==null?void 0:t.data.canDisband(e):!1},[e,s]),z=n.exports.useMemo(()=>()=>{var t;return e?(t=e.army)==null?void 0:t.data.disband(e):!1},[e,s]),J=n.exports.useMemo(()=>t=>e?L.get(t).availableToBuild(e):!1,[e,s]),K=n.exports.useMemo(()=>t=>e?L.get(t).canBuild(e):!1,[e,s]),N=n.exports.useMemo(()=>t=>e?L.get(t).build(e):!1,[e,s]),Q=n.exports.useMemo(()=>()=>{var t;return e?(t=e.landmark)==null?void 0:t.data.availableToDemolish(e):!1},[e,s]),V=n.exports.useMemo(()=>()=>{var t;return e?(t=e.landmark)==null?void 0:t.data.canDemolish(e):!1},[e,s]),W=n.exports.useMemo(()=>()=>{var t;return e?(t=e.landmark)==null?void 0:t.data.demolish(e):!1},[e,s]),X=n.exports.useMemo(()=>t=>{const u=R(t),E=A(t);return[C,u?null:F,E?null:j]},[e]),Z=n.exports.useMemo(()=>()=>{const t=v(),u=Y();return[C,t?null:F,u?null:j]},[e]),b=n.exports.useMemo(()=>t=>{const u=J(t),E=K(t);return[C,u?null:F,E?null:j]},[e]),I=n.exports.useMemo(()=>()=>{const t=Q(),u=V();return[C,t?null:F,u?null:j]},[e]),ee=n.exports.useMemo(()=>t=>e?h(t):null,[e]),re=n.exports.useMemo(()=>()=>e?z():null,[e]),x=n.exports.useMemo(()=>t=>e?N(t):null,[e]),te=n.exports.useMemo(()=>()=>e?W():null,[e]);return w(ne,{children:[w("div",{css:ue,children:[o("img",{css:de,src:y}),w("div",{css:O,children:[o("div",{children:"gold"}),o("div",{children:B})]}),w("div",{css:O,children:[o("div",{children:"army"}),o("div",{children:S})]}),w("div",{css:O,children:[o("div",{children:"turn"}),o("div",{children:k})]})]}),w("div",{css:me,children:[o("img",{css:X(f.Basic),src:D(f.Basic),onClick:()=>ee(f.Basic)}),o("img",{css:Z(),src:(H=m.uiCancel)==null?void 0:H.src,onClick:()=>re()}),o("img",{css:b(i.Capital),src:p(i.Capital),onClick:()=>x(i.Capital)}),o("img",{css:b(i.Church),src:p(i.Church),onClick:()=>x(i.Church)}),o("img",{css:b(i.Tower),src:p(i.Tower),onClick:()=>x(i.Tower)}),o("img",{css:b(i.House),src:p(i.House),onClick:()=>x(i.House)}),o("img",{css:b(i.Mountains),src:p(i.Mountains),onClick:()=>x(i.Mountains)}),o("img",{css:b(i.Forest),src:p(i.Forest),onClick:()=>x(i.Forest)}),o("img",{css:I(),src:(_=m.uiCancel)==null?void 0:_.src,onClick:()=>te()}),o("img",{css:C,src:(q=m.uiArrowRight)==null?void 0:q.src,onClick:()=>l.gameplay.nextTurn()})]})]})}export{fe as default};
