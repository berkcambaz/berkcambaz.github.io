import{C as h,l as k,m as N}from"./index-bac8f620.js";function C(e){const n=T(e);function t(i,o){return Math.floor(n()*(o-i)+i)}function r(){return t(1,6+1)}function u(i){let o=0;i.forEach(w=>{o+=w.percent});let f=t(0,o)+1,x=0;for(let w=0;w<i.length;++w){const m=i[w];if(m&&(x+=m.percent,f<=x))return m.result}}return{seed:e,number:t,dice:r,percent:u}}function T(e){return function(){var n=e+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}}var s=(e=>(e[e.None=-1]="None",e[e.CountryGreen=0]="CountryGreen",e[e.CountryPurple=1]="CountryPurple",e[e.CountryRed=2]="CountryRed",e[e.CountryYellow=3]="CountryYellow",e[e.Chest=4]="Chest",e[e.Banner=5]="Banner",e))(s||{});function M(){return{countries:[],tiles:[],running:!1,turn:{count:0,type:s.None},rng:C(Date.now()),width:0,height:0,seed:Date.now()}}var c=(e=>(e[e.None=-1]="None",e[e.Banner=0]="Banner",e[e.Mountains=1]="Mountains",e[e.Forest=2]="Forest",e[e.Chest=3]="Chest",e))(c||{});function j(e){switch(e==null?void 0:e.id){case h.Green:return s.CountryGreen;case h.Purple:return s.CountryPurple;case h.Red:return s.CountryRed;case h.Yellow:return s.CountryYellow;default:return s.None}}function A(e,n){switch(n){case s.CountryGreen:return e.countries.filter(t=>t.id===h.Green)[0];case s.CountryPurple:return e.countries.filter(t=>t.id===h.Purple)[0];case s.CountryRed:return e.countries.filter(t=>t.id===h.Red)[0];case s.CountryYellow:return e.countries.filter(t=>t.id===h.Yellow)[0];default:return}}function B(e,n){return!e||!n?!1:e.pos.x===n.pos.x&&e.pos.y===n.pos.y}function G(e,n){const t=e.countries.length,r=t*3+1,u=n-1-Math.floor(n/r);return n<0?s.None:n%r===0?n%2===1?s.Chest:s.Banner:l.countryToTurnType(e.countries[u%t])}function g(e,n){const t=[];return n.x-1>=0&&n.y-1>=0&&t.push(e.tiles[n.x-1+(n.y-1)*e.width]),n.y-1>=0&&t.push(e.tiles[n.x+0+(n.y-1)*e.width]),n.x+1<e.width&&n.y-1>=0&&t.push(e.tiles[n.x+1+(n.y-1)*e.width]),n.x-1>=0&&n.y+1<e.height&&t.push(e.tiles[n.x-1+(n.y+1)*e.width]),n.y+1<e.height&&t.push(e.tiles[n.x+0+(n.y+1)*e.width]),n.x+1<e.width&&n.y+1<e.height&&t.push(e.tiles[n.x+1+(n.y+1)*e.width]),n.x-1>=0&&t.push(e.tiles[n.x-1+(n.y+0)*e.width]),n.x+1<e.width&&t.push(e.tiles[n.x+1+(n.y+0)*e.width]),t.filter(r=>r)}function E(e,n,t){const r=e.tiles[t.x+t.y*e.width];return r?r.unit?r.unit.id!==n?[]:r.unit.attacked?[]:g(e,t).filter(o=>{var f;return!(o.unit&&o.unit.id===n||(f=r.unit)!=null&&f.moved&&!o.unit)}):[]:[]}function S(e,n,t){if(!n.unit||!t.unit)return 0;let r=0;const u=g(e,n.pos),i=g(e,t.pos);if(u.forEach(o=>{!n.unit||!t.unit||!o.unit||(o.unit.id===n.unit.id&&(r+=.5),o.unit.id===t.unit.id&&(r+=-1))}),i.forEach(o=>{!n.unit||!t.unit||!o.unit||(o.unit.id===n.unit.id&&(r+=-1),o.unit.id===t.unit.id&&(r+=.5))}),n.owner.id===n.unit.id)switch(n.landmark){case c.Forest:r+=2;break}if(t.owner.id===t.unit.id)switch(t.landmark){case c.Mountains:r-=2;break}return r}function Y(e,n,t){const r=e.tiles[t.x+t.y*e.width];if(!r||!r.unit)return;const u=g(e,t);let i=0;return r.unit.id===n?r.landmark===c.Forest&&(i+=2):r.landmark===c.Mountains&&(i+=-2),u.forEach(o=>{!o.unit||!r.unit||(o.unit.id===r.unit.id?i+=.5:i+=-1)}),i}const l={countryToTurnType:j,turnTypeToCountry:A,compareTile:B,getTurnType:G,getAdjacentTiles:g,getMoveableTiles:E,getWarModifier:S,getUnitModifier:Y};function R(e,n){return!e.running}function P(e,n){R(e)&&(e.running=!0,e.turn.type=l.getTurnType(e,e.turn.count))}function p(e){return{id:e,attacked:!0,moved:!0}}var y=(e=>(e[e.Nomad=0]="Nomad",e[e.Settled=1]="Settled",e))(y||{});function D(e,n){const t=l.turnTypeToCountry(e,e.turn.type);return!t||t.id===n.country}function F(e,n){if(!D(e,n))return;const t=e.turn.type,r=l.turnTypeToCountry(e,e.turn.type);switch(e.turn.count++,e.turn.type=l.getTurnType(e,e.turn.count),t){case s.Banner:U(e);break;case s.Chest:_(e);break;case s.CountryGreen:case s.CountryPurple:case s.CountryRed:case s.CountryYellow:O(e,r);break}}function U(e){e.countries.forEach(n=>{n.banners++})}function _(e){const n=e.tiles.filter(u=>!(u.unit||u.landmark!==c.None)),t=e.rng.number(0,n.length),r=n[t];r&&(r.landmark=c.Chest)}function O(e,n){n&&(e.tiles.forEach(t=>{t.owner.id===n.id&&(t.unit||t.landmark===c.Banner&&(t.unit=p(n.id)))}),e.tiles.forEach(t=>{t.unit&&t.unit.id===n.id&&(t.unit.attacked=!1,t.unit.moved=!1)}),e.tiles.forEach(t=>{if(t.unit&&t.owner.id!==t.unit.id)switch(t.landmark){case c.Banner:t.type===y.Settled?t.type=y.Nomad:t.type===y.Nomad&&(t.owner=n);break;default:t.owner=n;break}}))}function d(e,n){return{pos:e,owner:n,type:y.Nomad,landmark:c.None,unit:void 0}}const a={generate:W};function W(e){const n=C(e.seed),t=X(e,n);$(e,t),q(e,n)}function X(e,n){const t=[];for(let r=0;r<e.countries.length;++r){t[r]=[{x:n.number(0,e.width),y:n.number(0,e.height)}];for(let u=r-1;u>=0;--u)if(t[u][0].x===t[r][0].x&&t[u][0].y===t[r][0].y){--r;break}}for(let r=0;r<e.countries.length;++r)e.tiles[t[r][0].x+t[r][0].y*e.width]=d({x:t[r][0].x,y:t[r][0].y},e.countries[r]);return t}function $(e,n){let t=!0;for(;t;){t=!1;for(let r=0;r<e.countries.length;++r){if(n[r].length===0)continue;const u=n[r][0].x,i=n[r][0].y,o=u+(i-1)*e.width,f=u+1+i*e.width,x=u+(i+1)*e.width,w=u-1+i*e.width;i-1>-1&&!e.tiles[o]?(n[r].push({x:u,y:i-1}),e.tiles[o]=d({x:u,y:i-1},e.countries[r])):u+1<e.width&&!e.tiles[f]?(n[r].push({x:u+1,y:i}),e.tiles[f]=d({x:u+1,y:i},e.countries[r])):i+1<e.height&&!e.tiles[x]?(n[r].push({x:u,y:i+1}),e.tiles[x]=d({x:u,y:i+1},e.countries[r])):u-1>-1&&!e.tiles[w]?(n[r].push({x:u-1,y:i}),e.tiles[w]=d({x:u-1,y:i},e.countries[r])):n[r].splice(0,1),t=t||n[r]!==0}}}function q(e,n){for(let t=0;t<e.height;++t)for(let r=0;r<e.width;++r){const u=e.tiles[r+t*e.width],i=n.percent([{percent:10,result:c.Mountains},{percent:15,result:c.Forest},{percent:75,result:c.None}]);u&&i&&(u.landmark=i)}}function z(e,n){return!e.running}function H(e,n){z(e)&&(e.width=n.w,e.height=n.h,e.seed=n.seed,e.tiles=[],a.generate(e))}function J(e){return{id:e,banners:1}}function K(e,n){return!(e.countries.filter(r=>r.id===n.country).length>0||n.country===h.None)}function Q(e,n){K(e,n)&&e.countries.push(J(n.country))}function V(e,n){return e.countries.filter(r=>r.id===n.country).length>0}function Z(e,n){V(e,n)&&(e.countries=e.countries.filter(t=>t.id!==n.country))}function b(e,n){const t=e.countries.filter(o=>o.id===n.countryId)[0];if(!t)return!1;const r=l.turnTypeToCountry(e,e.turn.type);if(!r||r.id!==t.id)return!1;const u=e.tiles[n.pos.x+n.pos.y*e.width];if(!u||t.banners<=0||u.owner.id!==t.id||u.type!==y.Nomad||u.landmark!==c.None||u.unit)return!1;const i=l.getAdjacentTiles(e,n.pos);for(const o of i)if(o.landmark===c.Banner||o.unit&&o.unit.id!==t.id)return!1;return!0}function I(e,n){if(!b(e,n))return;const t=e.countries.filter(i=>i.id===n.countryId)[0];if(!t)return;const r=e.tiles[n.pos.x+n.pos.y*e.width];if(!r)return;r.type=y.Settled,r.landmark=c.Banner,r.unit=p(t.id),t.banners--,l.getAdjacentTiles(e,n.pos).forEach(i=>{i.type!==y.Settled&&(i.unit&&i.unit.id!==t.id||(i.owner=t,i.type=y.Settled))})}function v(e,n){const t=e.tiles[n.from.x+n.from.y*e.width],r=e.tiles[n.to.x+n.to.y*e.width];if(!t||!r||!t.unit||l.getMoveableTiles(e,t.unit.id,t.pos).filter(o=>o===r).length===0)return!1;const i=l.turnTypeToCountry(e,e.turn.type);return!(i&&t.unit.id!==i.id)}function L(e,n){if(!v(e,n))return;const t=e.tiles[n.from.x+n.from.y*e.width],r=e.tiles[n.to.x+n.to.y*e.width];if(!t||!r)return;const u=e.countries.filter(i=>{var o;return i.id===((o=t.unit)==null?void 0:o.id)})[0];if(u)if(r.unit){const i=l.getWarModifier(e,t,r),o=e.rng.dice(),f=e.rng.dice();o-f+i>0?(r.unit=t.unit,t.unit=void 0,r.unit&&(r.unit.attacked=!0)):t.unit=void 0}else r.unit=t.unit,t.unit=void 0,r.unit&&(r.unit.moved=!0),r.landmark===c.Chest&&(r.landmark=c.None,u.banners++)}const ee={start:P,nextTurn:F,generate:H,addCountry:Q,removeCountry:Z,placeBanner:I,placeBannerActable:b,moveUnit:L,moveUnitActable:v},ne={play:ee,util:l,createGameData:M},te={data:ne.createGameData(),country:void 0,hoveredTile:void 0,selectedUnitTile:void 0,moveableTiles:[],map:{positionX:0,positionY:0,scale:1}},ie=k(N((e,n)=>({...te})));export{c as L,s as T,y as a,M as c,ne as g,ie as u};
