var te=Object.defineProperty;var se=(s,e,r)=>e in s?te(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var w=(s,e,r)=>(se(s,typeof e!="symbol"?e+"":e,r),r);import{r as n,j as T,a as i,F as ne,b as G}from"./index.d4fe14c2.js";import{m as y,g as l,u as d,U as $,T as oe,L as P,s as m,a as L,b as o}from"./Game.750ecfda.js";class ie{constructor(e,r,t,c){this.id=e,this.spritesSmall=r,this.spritesBig=t,this.stats=c,this.id=e,this.spritesSmall=r,this.spritesBig=t,this.stats=c}getSpriteSmall(e){if(e===void 0)return;const r=this.spritesSmall[e];if(!!r)return r}getSpriteBig(e){if(e===void 0)return;const r=this.spritesBig[e];if(!!r)return r}getSpriteSmallSrc(e){const r=this.getSpriteSmall(e);return r?r.src:void 0}getSpriteBigSrc(e){const r=this.getSpriteBig(e);return r?r.src:void 0}update(e){!e.army||(e.army.acted||(e.army.morale+=.25),e.army.owner!==e.owner&&(e.army.morale-=.125),e.army.morale=y.clamp(e.army.morale,-3,1),e.army.acted=!1,e.army.moved=!1)}availableToRecruit(e){var t;const r=l.gameplay.currentCountry;return!(!r||r!==e.owner||e.army||!((t=e.landmark)!=null&&t.data.stats.recruitable))}canRecruit(e){return!(!e.isFree()||e.owner.gold<this.stats.gold||e.owner.manpower<e.owner.army+this.stats.manpower)}recruit(e){var r,t;!this.availableToRecruit(e)||!this.canRecruit(e)||(e.army=new M(this,e.owner),e.owner.gold-=this.stats.gold,this.addEffects(e),l.tilemap.drawTile(e),l.tilemap.showTiles((t=(r=l.tilemap.selectedTile)==null?void 0:r.army)==null?void 0:t.data.getMoves(l.tilemap.selectedTile)),d.getState().refreshCountry(),d.getState().refreshTile())}availableToDisband(e){var t;const r=l.gameplay.currentCountry;return!(!r||!e.army||r!==((t=e.army)==null?void 0:t.owner))}canDisband(e){const r=l.gameplay.currentCountry;return!(!r||r!==e.owner)}disband(e){!this.availableToDisband(e)||!this.canDisband(e)||(e.army=void 0,this.removeEffects(e),l.tilemap.drawTile(e),l.tilemap.showTiles([]),d.getState().refreshCountry(),d.getState().refreshTile())}availableToMove(e){const r=l.gameplay.currentCountry;return!(!r||!e.army||e.army.owner!==r)}canMove(e){return!(!e.army||e.army.acted&&e.army.moved)}getMoves(e){if(!this.availableToMove(e)||!this.canMove(e))return[];let r=$.getAdjacentTiles(e);return r=r.filter(t=>{var c,f;return((c=t.army)==null?void 0:c.owner)!==((f=e.army)==null?void 0:f.owner)}),e.army&&!e.army.moved&&e.army.acted&&(r=r.filter(t=>!t.army)),e.army&&!e.army.acted&&e.army.moved&&(r=r.filter(t=>{var c;return t.army&&t.army.owner!==((c=e.army)==null?void 0:c.owner)})),r}move(e,r){!e||!e.army||!r||!this.availableToMove(e)||!this.canMove(e)||!oe.includes(r,l.tilemap.shownTiles)||(P.logMove(e,r),e.army.moved=!0,r.army?(e.army.acted=!0,this.attack(e,r)):(r.army=e.army,e.army=void 0),l.tilemap.drawTile(e),l.tilemap.drawTile(r),d.getState().refreshCountry(),d.getState().refreshTile())}attack(e,r){if(!e.army||!r.army)return;const t=l.tilemap.srandom.dice(),c=l.tilemap.srandom.dice(),f=e.army.data.stats.offensive,B=r.army.data.stats.defensive,S=e.landmark?e.landmark.data.stats.offensive:0,k=r.landmark?r.landmark.data.stats.defensive:0,D=$.getSupportBonus(e),p=$.getSupportBonus(r),R=e.army.morale,A=r.army.morale,h=t+f+S+D+R,v=c+B+k+p+A;P.logAttack({allyDice:t,allyArmyBonus:f,allyLandmarkBonus:S,allySupportBonus:D,allyMorale:R,enemyDice:c,enemyArmyBonus:B,enemyLandmarkBonus:k,enemySupportBonus:p,enemyMorale:A,ally:h,enemy:v}),h>v?(e.army.morale=y.clamp(e.army.morale-.125,-3,1),this.removeEffects(r),r.army=e.army,e.army=void 0):h===v?(e.army.morale=y.clamp(e.army.morale-.25,-3,1),r.army.morale=y.clamp(r.army.morale-.25,-3,1)):v>h&&(r.army.morale=y.clamp(r.army.morale-.125,-3,1),this.removeEffects(e),e.army=void 0)}addEffects(e){e.owner.army+=this.stats.manpower}removeEffects(e){e.owner.army-=this.stats.manpower}onFree(e){return!0}onOccupy(e){return!0}onConquer(e){return!0}}var g=(s=>(s[s.Basic=0]="Basic",s))(g||{});class le extends ie{constructor(){super(g.Basic,[m.armyGreenSmall,m.armyPurpleSmall,m.armyRedSmall,m.armyYellowSmall],[m.armyGreenBig,m.armyPurpleBig,m.armyRedBig,m.armyYellowBig],{gold:2,manpower:1,offensive:0,defensive:0,breakthrough:0})}}class M{constructor(e,r){w(this,"data");w(this,"owner");w(this,"morale",0);w(this,"moved",!1);w(this,"acted",!0);this.data=e,this.owner=r}static get(e){switch(e){case g.Basic:return new le}}}const ce={name:"220rkc",styles:"color:#fff"},F={name:"eivff4",styles:"display:none"},j={name:"eqd9i9",styles:"background-color:rgb(128, 128, 128, 0.5)"},U={name:"pp2au",styles:"height:64px;position:absolute;left:0;right:0;display:flex;flex-direction:row;align-items:center;justify-content:center"},ue=G(U," top:0;background-image:linear-gradient(180deg,  rgba(0, 0, 0, 0.75) , rgba(0, 0, 0, 0));",""),me=G(U," bottom:0;background-image:linear-gradient(0deg,  rgba(0, 0, 0, 0.75) , rgba(0, 0, 0, 0));",""),de={name:"18jhpep",styles:"width:48px;height:48px"},O=G(ce," display:flex;flex-direction:column;align-items:center;&:nth-of-type(n){margin-right:1rem;}&:last-of-type{margin-right:0;}",""),C={name:"1fax00o",styles:"cursor:pointer;width:48px;height:48px;background-color:rgb(256, 256, 256, 0.5);border-radius:50%;&:hover{border:1px solid #fff;padding:1px;}&:nth-of-type(n){margin-right:1rem;}&:last-of-type{margin-right:0;}"};function ge(){var H,_,q;const s=d(a=>a.currentCountry),e=d(a=>a.refreshCurrentCountry),r=d(a=>a.currentTile),t=d(a=>a.refrestCurrentTile),c=d(a=>a.turn),f=n.exports.useMemo(()=>{if(!s)return;const a=M.get(g.Basic).spritesBig[s.id];if(!!a)return a.src},[s,e]),B=n.exports.useMemo(()=>{if(!s)return"-";const a=y.clamp(s.gold,-999,999),u=y.clamp(s.income,-999,999);return`${a} (${u>=0?"+":"-"}${u})`},[s,e]),S=n.exports.useMemo(()=>{if(!s)return"-";const a=y.clamp(s.army,0,999),u=y.clamp(s.manpower,0,999);return`${a} / ${u}`},[s,e]),k=n.exports.useMemo(()=>`${c>999?"+999":c}`,[c]),D=n.exports.useMemo(()=>a=>M.get(a).getSpriteBigSrc(s==null?void 0:s.id),[s,e]),p=n.exports.useMemo(()=>a=>L.get(a).getSpriteSrc(s==null?void 0:s.id),[s,e]),R=n.exports.useMemo(()=>a=>r?M.get(a).availableToRecruit(r):!1,[r,t]),A=n.exports.useMemo(()=>a=>r?M.get(a).canRecruit(r):!1,[r,t]),h=n.exports.useMemo(()=>a=>r?M.get(a).recruit(r):!1,[r,t]),v=n.exports.useMemo(()=>()=>{var a;return r?(a=r.army)==null?void 0:a.data.availableToDisband(r):!1},[r,t]),Y=n.exports.useMemo(()=>()=>{var a;return r?(a=r.army)==null?void 0:a.data.canDisband(r):!1},[r,t]),z=n.exports.useMemo(()=>()=>{var a;return r?(a=r.army)==null?void 0:a.data.disband(r):!1},[r,t]),J=n.exports.useMemo(()=>a=>r?L.get(a).availableToBuild(r):!1,[r,t]),K=n.exports.useMemo(()=>a=>r?L.get(a).canBuild(r):!1,[r,t]),N=n.exports.useMemo(()=>a=>r?L.get(a).build(r):!1,[r,t]),Q=n.exports.useMemo(()=>()=>{var a;return r?(a=r.landmark)==null?void 0:a.data.availableToDemolish(r):!1},[r,t]),V=n.exports.useMemo(()=>()=>{var a;return r?(a=r.landmark)==null?void 0:a.data.canDemolish(r):!1},[r,t]),W=n.exports.useMemo(()=>()=>{var a;return r?(a=r.landmark)==null?void 0:a.data.demolish(r):!1},[r,t]),X=n.exports.useMemo(()=>a=>{const u=R(a),E=A(a);return[C,u?null:F,E?null:j]},[r]),Z=n.exports.useMemo(()=>()=>{const a=v(),u=Y();return[C,a?null:F,u?null:j]},[r]),b=n.exports.useMemo(()=>a=>{const u=J(a),E=K(a);return[C,u?null:F,E?null:j]},[r]),I=n.exports.useMemo(()=>()=>{const a=Q(),u=V();return[C,a?null:F,u?null:j]},[r]),ee=n.exports.useMemo(()=>a=>r?h(a):null,[r]),re=n.exports.useMemo(()=>()=>r?z():null,[r]),x=n.exports.useMemo(()=>a=>r?N(a):null,[r]),ae=n.exports.useMemo(()=>()=>r?W():null,[r]);return T(ne,{children:[T("div",{css:ue,children:[i("img",{css:de,src:f}),T("div",{css:O,children:[i("div",{children:"gold"}),i("div",{children:B})]}),T("div",{css:O,children:[i("div",{children:"army"}),i("div",{children:S})]}),T("div",{css:O,children:[i("div",{children:"turn"}),i("div",{children:k})]})]}),T("div",{css:me,children:[i("img",{css:X(g.Basic),src:D(g.Basic),onClick:()=>ee(g.Basic)}),i("img",{css:Z(),src:(H=m.uiCancel)==null?void 0:H.src,onClick:()=>re()}),i("img",{css:b(o.Capital),src:p(o.Capital),onClick:()=>x(o.Capital)}),i("img",{css:b(o.Church),src:p(o.Church),onClick:()=>x(o.Church)}),i("img",{css:b(o.Tower),src:p(o.Tower),onClick:()=>x(o.Tower)}),i("img",{css:b(o.House),src:p(o.House),onClick:()=>x(o.House)}),i("img",{css:b(o.Mountains),src:p(o.Mountains),onClick:()=>x(o.Mountains)}),i("img",{css:b(o.Forest),src:p(o.Forest),onClick:()=>x(o.Forest)}),i("img",{css:I(),src:(_=m.uiCancel)==null?void 0:_.src,onClick:()=>ae()}),i("img",{css:C,src:(q=m.uiArrowRight)==null?void 0:q.src,onClick:()=>l.gameplay.nextTurn()})]})]})}export{ge as default};
