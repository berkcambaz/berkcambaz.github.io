import{C as f,l as T,m as k}from"./index-397ef9b3.js";function p(e){const n=B(e);function t(i,o){return Math.floor(n()*(o-i)+i)}function r(){return t(1,6+1)}function u(i){let o=0;i.forEach(w=>{o+=w.percent});let h=t(0,o)+1,g=0;for(let w=0;w<i.length;++w){const x=i[w];if(x&&(g+=x.percent,h<=g))return x.result}}return{seed:e,number:t,dice:r,percent:u}}function B(e){return function(){var n=e+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}}var s=(e=>(e[e.None=-1]="None",e[e.CountryGreen=0]="CountryGreen",e[e.CountryPurple=1]="CountryPurple",e[e.CountryRed=2]="CountryRed",e[e.CountryYellow=3]="CountryYellow",e[e.Chest=4]="Chest",e[e.Banner=5]="Banner",e))(s||{});function M(){return{countries:[],tiles:[],running:!1,turn:{count:0,type:s.None},rng:p(Date.now()),width:0,height:0,seed:Date.now()}}var c=(e=>(e[e.None=-1]="None",e[e.Banner=0]="Banner",e[e.Mountains=1]="Mountains",e[e.Forest=2]="Forest",e[e.Chest=3]="Chest",e))(c||{});function j(e){switch(e==null?void 0:e.id){case f.Green:return s.CountryGreen;case f.Purple:return s.CountryPurple;case f.Red:return s.CountryRed;case f.Yellow:return s.CountryYellow;default:return s.None}}function A(e,n){switch(n){case s.CountryGreen:return e.countries.filter(t=>t.id===f.Green)[0];case s.CountryPurple:return e.countries.filter(t=>t.id===f.Purple)[0];case s.CountryRed:return e.countries.filter(t=>t.id===f.Red)[0];case s.CountryYellow:return e.countries.filter(t=>t.id===f.Yellow)[0];default:return}}function G(e,n){return!e||!n?!1:e.pos.x===n.pos.x&&e.pos.y===n.pos.y}function S(e,n){const t=e.countries.length,r=t*3+1,u=n-1-Math.floor(n/r);return n<0?s.None:n%r===0?n%2===1?s.Chest:s.Banner:l.countryToTurnType(e.countries[u%t])}function C(e,n){const t=[];return n.x-1>=0&&n.y-1>=0&&t.push(e.tiles[n.x-1+(n.y-1)*e.width]),n.y-1>=0&&t.push(e.tiles[n.x+0+(n.y-1)*e.width]),n.x+1<e.width&&n.y-1>=0&&t.push(e.tiles[n.x+1+(n.y-1)*e.width]),n.x-1>=0&&n.y+1<e.height&&t.push(e.tiles[n.x-1+(n.y+1)*e.width]),n.y+1<e.height&&t.push(e.tiles[n.x+0+(n.y+1)*e.width]),n.x+1<e.width&&n.y+1<e.height&&t.push(e.tiles[n.x+1+(n.y+1)*e.width]),n.x-1>=0&&t.push(e.tiles[n.x-1+(n.y+0)*e.width]),n.x+1<e.width&&t.push(e.tiles[n.x+1+(n.y+0)*e.width]),t.filter(r=>r)}function Y(e,n,t){const r=e.tiles[t.x+t.y*e.width];return r?r.unit?r.unit.id!==n?[]:r.unit.attacked?[]:C(e,t).filter(o=>{var h;return!(o.unit&&o.unit.id===n||(h=r.unit)!=null&&h.moved&&!o.unit)}):[]:[]}function R(e,n,t){if(!n.unit||!t.unit)return 0;const r=d(e,n.unit.id,n.pos),u=d(e,n.unit.id,t.pos);return r===void 0||u===void 0?0:r-u}function d(e,n,t){const r=e.tiles[t.x+t.y*e.width];if(!r||!r.unit)return;const u=C(e,t);let i=0;return r.unit.id===n?r.landmark===c.Forest&&(i+=2):r.landmark===c.Mountains&&(i+=2),u.forEach(o=>{!o.unit||!r.unit||(o.unit.id===r.unit.id?i+=.5:i+=-1)}),i}const l={countryToTurnType:j,turnTypeToCountry:A,compareTile:G,getTurnType:S,getAdjacentTiles:C,getMoveableTiles:Y,getWarModifier:R,getUnitModifier:d};function E(e,n){return!(e.running||e.countries.filter(t=>t.id!==f.None).length<2)}function P(e,n){E(e)&&(e.running=!0,e.turn.type=l.getTurnType(e,e.turn.count))}function v(e){return{id:e,attacked:!0,moved:!0}}var y=(e=>(e[e.Nomad=0]="Nomad",e[e.Settled=1]="Settled",e))(y||{});function D(e,n){const t=l.turnTypeToCountry(e,e.turn.type);return!t||t.id===n.country}function U(e,n){if(!D(e,n))return;const t=e.turn.type,r=l.turnTypeToCountry(e,e.turn.type);switch(e.turn.count++,e.turn.type=l.getTurnType(e,e.turn.count),t){case s.Banner:F(e);break;case s.Chest:_(e);break;case s.CountryGreen:case s.CountryPurple:case s.CountryRed:case s.CountryYellow:O(e,r);break}}function F(e){e.countries.forEach(n=>{n.banners++})}function _(e){const n=e.tiles.filter(u=>!(u.unit||u.landmark!==c.None)),t=e.rng.number(0,n.length),r=n[t];r&&(r.landmark=c.Chest)}function O(e,n){n&&(e.tiles.forEach(t=>{t.unit||t.owner.id===n.id&&t.landmark===c.Banner&&(t.unit=v(n.id))}),e.tiles.forEach(t=>{t.unit&&t.unit.id===n.id&&(t.unit.attacked=!1,t.unit.moved=!1)}),e.tiles.forEach(t=>{if(t.unit&&t.unit.id===n.id&&t.owner.id!==t.unit.id)switch(t.landmark){case c.Banner:t.type===y.Settled?t.type=y.Nomad:t.type===y.Nomad&&(t.owner=n);break;default:t.owner=n;break}}))}function m(e,n){return{pos:e,owner:n,type:y.Nomad,landmark:c.None,unit:void 0}}const W={generate:X};function X(e){const n=p(e.seed),t=$(e,n);q(e,t),z(e,n)}function $(e,n){const t=[];for(let r=0;r<e.countries.length;++r){t[r]=[{x:n.number(0,e.width),y:n.number(0,e.height)}];for(let u=r-1;u>=0;--u)if(t[u][0].x===t[r][0].x&&t[u][0].y===t[r][0].y){--r;break}}for(let r=0;r<e.countries.length;++r)e.tiles[t[r][0].x+t[r][0].y*e.width]=m({x:t[r][0].x,y:t[r][0].y},e.countries[r]);return t}function q(e,n){let t=!0;for(;t;){t=!1;for(let r=0;r<e.countries.length;++r){if(n[r].length===0)continue;const u=n[r][0].x,i=n[r][0].y,o=u+(i-1)*e.width,h=u+1+i*e.width,g=u+(i+1)*e.width,w=u-1+i*e.width;i-1>-1&&!e.tiles[o]?(n[r].push({x:u,y:i-1}),e.tiles[o]=m({x:u,y:i-1},e.countries[r])):u+1<e.width&&!e.tiles[h]?(n[r].push({x:u+1,y:i}),e.tiles[h]=m({x:u+1,y:i},e.countries[r])):i+1<e.height&&!e.tiles[g]?(n[r].push({x:u,y:i+1}),e.tiles[g]=m({x:u,y:i+1},e.countries[r])):u-1>-1&&!e.tiles[w]?(n[r].push({x:u-1,y:i}),e.tiles[w]=m({x:u-1,y:i},e.countries[r])):n[r].splice(0,1),t=t||n[r]!==0}}}function z(e,n){for(let t=0;t<e.height;++t)for(let r=0;r<e.width;++r){const u=e.tiles[r+t*e.width],i=n.percent([{percent:10,result:c.Mountains},{percent:15,result:c.Forest},{percent:75,result:c.None}]);u&&i&&(u.landmark=i)}}function H(e,n){return!e.running}function J(e,n){H(e)&&(e.width=n.w,e.height=n.h,e.seed=n.seed,e.tiles=[],W.generate(e))}function K(e){return{id:e,banners:1}}function Q(e,n){return!(e.countries.filter(r=>r.id===n.country).length>0||n.country===f.None)}function V(e,n){Q(e,n)&&e.countries.push(K(n.country))}function Z(e,n){return e.countries.filter(r=>r.id===n.country).length>0}function I(e,n){Z(e,n)&&(e.countries=e.countries.filter(t=>t.id!==n.country))}function b(e,n){const t=e.countries.filter(o=>o.id===n.countryId)[0];if(!t)return!1;const r=l.turnTypeToCountry(e,e.turn.type);if(!r||r.id!==t.id)return!1;const u=e.tiles[n.pos.x+n.pos.y*e.width];if(!u||t.banners<=0||u.owner.id!==t.id||u.type!==y.Nomad||u.landmark!==c.None||u.unit)return!1;const i=l.getAdjacentTiles(e,n.pos);for(const o of i)if(o.landmark===c.Banner||o.unit&&o.unit.id!==t.id)return!1;return!0}function L(e,n){if(!b(e,n))return;const t=e.countries.filter(i=>i.id===n.countryId)[0];if(!t)return;const r=e.tiles[n.pos.x+n.pos.y*e.width];if(!r)return;r.type=y.Settled,r.landmark=c.Banner,r.unit=v(t.id),t.banners--,l.getAdjacentTiles(e,n.pos).forEach(i=>{i.type!==y.Settled&&(i.unit&&i.unit.id!==t.id||(i.owner=t,i.type=y.Settled))})}function N(e,n){const t=e.tiles[n.from.x+n.from.y*e.width],r=e.tiles[n.to.x+n.to.y*e.width];if(!t||!r||!t.unit||l.getMoveableTiles(e,t.unit.id,t.pos).filter(o=>o===r).length===0)return!1;const i=l.turnTypeToCountry(e,e.turn.type);return!(i&&t.unit.id!==i.id)}function a(e,n){if(!N(e,n))return;const t=e.tiles[n.from.x+n.from.y*e.width],r=e.tiles[n.to.x+n.to.y*e.width];if(!t||!r)return;const u=e.countries.filter(i=>{var o;return i.id===((o=t.unit)==null?void 0:o.id)})[0];if(u)if(r.unit){const i=l.getWarModifier(e,t,r),o=e.rng.dice(),h=e.rng.dice();o-h+i>0?(r.unit=t.unit,t.unit=void 0,r.unit&&(r.unit.attacked=!0)):t.unit=void 0}else r.unit=t.unit,t.unit=void 0,r.unit&&(r.unit.moved=!0),r.landmark===c.Chest&&(r.landmark=c.None,u.banners++)}const ee={start:P,nextTurn:U,generate:J,addCountry:V,removeCountry:I,placeBanner:L,placeBannerActable:b,moveUnit:a,moveUnitActable:N},ne={play:ee,util:l,createGameData:M},te={data:ne.createGameData(),country:void 0,hoveredTile:void 0,selectedUnitTile:void 0,moveableTiles:[],map:{positionX:0,positionY:0,scale:1}},ie=T(k((e,n)=>({...te})));export{c as L,s as T,y as a,M as c,ne as g,ie as u};
